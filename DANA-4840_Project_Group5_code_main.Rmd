---
title: "DANA 4840 Project"
author: "Group 5 - Baudot, Caquilala, Dinesh, Gupta, Thakur"
date: "2024-03-31"
output:
  word_document: default
  html_document: default
---

**Table of Contents**  
A. Data Collection	
1. Describe the data set  
2. How we obtained the data  
3. Possible bias  


B. Literature Review	 

C. Exploratory Data Analysis	 
1. Preparation  
3. Missing values   
4. Numerical   
5. Categorical    
6. Outliers    
7. Correlation, heatmap, multicolinearity    
	
D. Clustering  	
1.	Distances (spearman, pearson, eucl, …), mixed  
2.	Clustering tendency validation  
3.	k-means  
4.	k-medoids / Clara  
5.	hierarchical  
6.	other techniques  
  
E. Classification	
1.	FA  
2.	Stepwise  

F. Questions of interest  
Q1.	Using clustering, are players grouped based on their overall ratings, skill ratings, physical characteristics, and wages? What is the distribution across the clusters in terms of league, club, position, nationality, and reputation?"  
Q2. Can we identify the team with the best worth in each league for an affordable investment?  
Q3. Predict the wage of a player in each league based on their abilities, physical characteristics, and nationality.  
Q4. Can we determine the international player’s reputation from their contribution to their club?  
  
G. Conclusion	 
1.	Techniques we used to answer the 4 questions  
2.	Summary of the answers  
3.	What we can have done better  

-------------------------------------------------- CODE START --------------------------------------------------  


Parameters. Remove the warnings when knitting.  

```{r setup}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)

# Don't print number in scientific format. 6 decimals
options(scipen = 6)
```

Import all the necessary packages  

```{r}
#ONE TIME install.packages("gt")
library(gt)
library(cluster)
library(factoextra)
library(stats)
library(fpc)
library(tibble)
#library(dlookr)
library(ggplot2)
library(tidyr)
library(e1071)
library(gridExtra)
library(dplyr)
library(corrplot)
library(dendextend)
library(car)
library(reshape2)
library(forcats)
library(clValid)
library(NbClust)
library(GGally)
library(psych)
library(knitr)
library(scales)
```

  ===================  
# A. Data Collection	 
  ===================  
  

##	1. Dataset Description  

```{r }
# Load required library
# Create a data frame
df <- data.frame(Variable = c("short_name", "league_name", "club_name", "club_position", "nationality_name", "body_type", "preferred_foot", "international_reputation", "age", "height_cm", "weight_kg", "value_eur", "wage_eur", "overall", "potential", "pace", "shooting", "passing", "dribbling", "defending", "physic"),
                 Type = c("categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "categorical", "numerical", "numerical", "numerical", "numerical", "numerical", "numerical", "numerical", "numerical", "numerical", "numerical", "numerical", "numerical", "numerical"),
            Measure = c("character", "4 leagues level 1: England, France, Italy, Spain", "~20 clubs per league", "25 different positions. Attacking, Defensing, Midfield, Left, Right, Center", "character", "Lean, Normal, Stocky, Unique", "binary Left, Right", "rating 1-5", "years", "centimeters", "kilograms", "amount in Euros", "amount in Euros", "rating 1-100", "rating 1-100", "rating 1-100", "rating 1-100", "rating 1-100", "rating 1-100", "rating 1-100", "rating 1-100"),
                 Description = c("Player's name.", "League the player's club team competes in.", "Club team the player is currently playing for.", "Player's position in the club's formation", "Nationality of the player.", "Player's body type.", "Player's preferred foot for playing.", "Player's international reputation rating.", "Player's age.", "Player's height.", "Player's weight.", "Player's market value.", "Player's monthly wage.", "Overall rating of the player's skills and performance.", "Potential rating representing the maximum overall rating the player can achieve.", "Rating representing the player's abilities in pace.", "Rating representing the player's abilities in shooting.", "Rating representing the player's abilities in passing.", "Rating representing the player's abilities in dribbling.", "Rating representing the player's abilities in defending.", "Rating representing the player's abilities in physic."))

# Create gt table
tbl <- gt(df)

# Add column labels
tbl <- tbl %>%
  tab_header(
    title = "Data Summary",
    subtitle = "Summary of Variables"
  ) %>%
  cols_label(
    Variable = "Variable",
    Type = "Type",
    Measure = "Measure",
    Description = "Description"
  )

# Print the table
print(tbl)

```

##	2. How the Data was Obtained  


The FIFA dataset was obtained from Kaggle (https://www.kaggle.com/datasets/stefanoleone992/fifa-22-complete-player-dataset).  

The original dataset comprises of data from 2014 to 2022, with every file ranging in rows of 16155 and 110 columns.  

The population is made up of 19,239 male soccer players from 55 soccer leagues, with player data taken from the Career Mode of the FIFA 22 computer game. For the sample dataset, 880 players from the 80 clubs in the 1st level leagues in England, France, Italy, and Spain for season 2022 were considered. All players from the FIFA game are selected except the Substitutes and Reserves. Only 21 of the 82 columns in the original dataset have been kept for this project.  

The CSV file was converted to UTF-8 with an editor to have the name of the players displayed correctly in languages other than English. The new column created "attack_position" is from the club_position variable in the dataset and ranges in 4 values Attack, Midfield, Defense, GoalKeeper. Note that this was done in Excel before loading the data file in R.  
  
##	3. Possible bias  

*Sampling Bias*  
By focusing on the 880 players from the first-level leagues in England, France, Italy, and Spain, the analysis might not account for emerging talents or high-performing players in lower leagues or other countries. This could impact the generalizability of the findings.  

*Game-Based Ratings*  
SoFIFA's subjective player ratings may not fully match real-world performances.  

*Market Value Misalignment*  
In-game values and wages might not reflect real market conditions accurately.  

*Potential Bias from Overlooking Substitutes and Reserves*   
By excluding substitutes and reserves, the dataset misses out on capturing the complete strength and strategy of a team, as these players contribute significantly to performance, injury management, and match tactics. This could lead to an incomplete understanding of team capabilities.  



  =====================  
# B. Literature Review	 
  =====================  
	
	
  ============================  
# C. Exploratory Data Analysis	 
  ============================  

## 1. Dataset Preparation  

Read the fifa.csv data.  

```{r}
fifa <- read.csv("fifa.csv", header=TRUE, sep=",", fileEncoding = "UTF-8")
head(fifa, 12)
```

```{r}
str(fifa)
```

Column names  

```{r}
colnames(fifa)
```

## 2. Missing values  

Check the data summary to look for missing values.  

```{r}
total_na <- sum(is.na(fifa)) #total NA in all columns
print(total_na)
na_counts <- colSums(is.na(fifa)) #total NA in each columns
columns_with_na <- na_counts[na_counts > 0] # print only positive values
print(columns_with_na)
```

We have a total of 480 missing values, which are 80 missing values in all the 6 rating variables pace, shooting, passing, dribbling, defending, physic.  

Extract the goal keepers:  

```{r}
fifa.gk <- subset(fifa, club_position=='GK')
#head(fifa.gk)
dim(fifa.gk)
```

Missing values in goal keepers:  

```{r}
total_na_gk <- sum(is.na(fifa.gk)) #total NA in all columns
print(total_na_gk)
na_counts_gk <- colSums(is.na(fifa.gk)) #total NA in each columns
columns_with_na_gk <- na_counts_gk[na_counts_gk > 0] # print only positive values
print(columns_with_na_gk)
```

Looking at the data in more detail, it appears that all values in pace, shooting, passing, dribbling, defending, physic are missing for all the Goal Keepers in the dataset.   

We can analyse the player performance and separate the goal keepers when necessary.  

There are no other missing values in the dataset.  

## 3. Data Preprocessing  

### a. Set short_name as rownames  

Show duplicate rows  

```{r}
#Show duplicate rows
fifa[duplicated(fifa$short_name),]
```

There are 3 pairs of players with the same short name but they have different stats and play in different clubs.  

Make the names unique and use them as rownames.  

```{r}
#Make duplicate short_name unique
fifa$short_name <- make.unique(fifa$short_name, sep = "_")

#Set short_name as row names
rownames(fifa) <- fifa$short_name

#Remove original column from data frame
fifa$short_name <- NULL
```


### b. Create Subsets  

Extract each league in a different subset.  

```{r}
fifa.eng <- subset(fifa, league_name=='English Premier League')
fifa.fra <- subset(fifa, league_name=='French Ligue 1')
fifa.ita <- subset(fifa, league_name=='Italian Serie A')
fifa.spn <- subset(fifa, league_name=='Spain Primera Division')
```

Extract each position (simple) in a different subset.  

```{r}
fifa.att <- subset(fifa, attack_position=='Attack')
fifa.mid <- subset(fifa, attack_position=='Midfield')
fifa.def <- subset(fifa, attack_position=='Defense')
fifa.gok <- subset(fifa, attack_position=='GoalKeeper')
```

Extract numerical variables only.  

```{r}
columns_numerical <- c("overall", "potential", "value_eur", "wage_eur", "age", "height_cm", "weight_kg", "pace", "shooting", "passing", "dribbling", "defending", "physic")
fifa.num <- fifa[columns_numerical]
```

Extract numerical attributes, excluding individual skill ratings (keep the goalkeepers).  

```{r}
columns_num_inGK <- c("overall", "potential", "value_eur", "wage_eur", "age", "height_cm", "weight_kg")
fifa.num.inGK <- fifa[columns_num_inGK] #just numerical including Goalkeepers, excluding individual skill ratings
```

Extract numerical and categorical attributes, excluding individual skill ratings (keep the goalkeepers).  

```{r}
columns_inGK <- c("overall", "potential", "value_eur", "wage_eur", "age", "height_cm", "weight_kg", "club_name", "league_name", "club_position", "attack_position", "nationality_name", "preferred_foot", "international_reputation", "body_type")
fifa.inGK <- fifa[columns_inGK] #numerical/categorical including Goalkeepers, excluding individual skill ratings
```

Exclude goalkeepers.  

```{r}
fifa.num.exGK <- na.omit(fifa.num) #numerical excluding Goalkeepers, including individual skill ratings
fifa.exGK <- na.omit(fifa) #numerical/categorical excluding Goalkeepers, including individual skill ratings
```

### c. Standardize data  

```{r}
fifa.num.scaled <- scale(fifa.num) # includes NAs 
fifa.num.inGK.scaled <- scale(fifa.num.inGK) # just numerical including Goalkeepers, excluding individual skill ratings
fifa.num.exGK.scaled <- scale(fifa.num.exGK) # just numerical excluding Goalkeepers, including individual skill ratings
fifa.inGK.scaled <- fifa.inGK %>% mutate(across(where(is.numeric), scale)) #may not be needed
fifa.exGK.scaled <- fifa.exGK %>% mutate(across(where(is.numeric), scale)) #may not be needed
```

##	4. EDA on Numerical Variables  

### a. Univariate Analysis  

#### i. Measures of Central Tendency  

##### a. Descriptive Statistics  

```{r}
describe(fifa.num)[,1:9]
```

*Central Tendency*  

**Age**: On average, FIFA players are around 27 years old, with the youngest player at 17 and oldest player at 39 years.  
**Overall Rating**: The average skill level of players is roughly 77, indicating a good level of performance.  
**Potential**: Players have an average potential rating of 80, suggesting they have the capability to perform slightly better than their current level.  
**Wage**: The average wage for players is about EUR 50,500, showing what players earn on a regular basis.  
**Value**: On average, players are valued at around EUR 18.6 million, indicating their market worth.  

*Skewness*  

Age, Overall, and Potential show relatively symmetric distributions with slight right skewness, indicating a general clustering around the mean with some outliers on the higher end.  
Wage and Value have highly right-skewed distributions. The high skewness highlights the presence of outliers - a few players with exceptionally high wages and values compared to the rest.  


#### ii. Measures of Variability/Spread  

##### a. Histogram  


```{r, warning=FALSE, message=FALSE}
# Histogram for 'age'
p1 <- ggplot(fifa, aes(x = age)) +
  geom_histogram(aes(fill = ..count..), binwidth = NULL, color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Age Distribution", x = "Age", y = "Count")

# Histogram for 'overall'
p2 <- ggplot(fifa, aes(x = overall)) +
  geom_histogram(aes(fill = ..count..), binwidth = NULL, color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Overall Rating Distribution", x = "Overall Rating", y = "Count")

# Histogram for 'potential'
p3 <- ggplot(fifa, aes(x = potential)) +
  geom_histogram(aes(fill = ..count..), binwidth = NULL, color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Potential Rating Distribution", x = "Potential Rating", y = "Count")

# Histogram for 'wage'
p4 <- ggplot(fifa, aes(x = wage_eur)) +
  geom_histogram(aes(fill = ..count..), binwidth = NULL, color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Wage Distribution", x = "Wage (EUR)", y = "Count")

# Histogram for 'value'
p5 <- ggplot(fifa, aes(x = value_eur)) +
  geom_histogram(aes(fill = ..count..), binwidth = NULL, color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Value Distribution", x = "Value (EUR)", y = "Count")

# Histogram for 'height_cm'
p6 <- ggplot(fifa, aes(x = height_cm)) +
  geom_histogram(aes(fill = ..count..), color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Height Distribution", x = "Height (cm)", y = "Count")

# Histogram for 'weight_kg'
p7 <- ggplot(fifa, aes(x = weight_kg)) +
  geom_histogram(aes(fill = ..count..), color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Weight Distribution", x = "Weight (kg)", y = "Count")

# Histogram for 'pace'
p8 <- ggplot(fifa, aes(x = pace)) +
  geom_histogram(aes(fill = ..count..), color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Pace Distribution", x = "Pace", y = "Count")

# Histogram for 'shooting'
p9 <- ggplot(fifa, aes(x = shooting)) +
  geom_histogram(aes(fill = ..count..), color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Shooting Distribution", x = "Shooting", y = "Count")

# Histogram for 'passing'
p10 <- ggplot(fifa, aes(x = passing)) +
  geom_histogram(aes(fill = ..count..), color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Passing Distribution", x = "Passing", y = "Count")

# Histogram for 'dribbling'
p11 <- ggplot(fifa, aes(x = dribbling)) +
  geom_histogram(aes(fill = ..count..), color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Dribbling Distribution", x = "Dribbling", y = "Count")

# Histogram for 'defending'
p12 <- ggplot(fifa, aes(x = defending)) +
  geom_histogram(aes(fill = ..count..), color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Defending Distribution", x = "Defending", y = "Count")

# Histogram for 'physic'
p13 <- ggplot(fifa, aes(x = physic)) +
  geom_histogram(aes(fill = ..count..), color = "black") +
  scale_fill_gradient(low = "lightblue", high = "dodgerblue") +
  labs(title = "Physic Distribution", x = "Physic", y = "Count")


grid.arrange(grobs = list(p1, p2, p3, p4), ncol = 2)
grid.arrange(grobs = list(p5, p6, p7, p8), ncol = 2)
grid.arrange(grobs = list(p9, p10, p11, p12, p13), ncol = 2)



```
Age: Bell-shaped distribution centered around late 20s.  
Overall Rating: Slightly left-skewed distribution with a peak in the mid-70s.  
Potential Rating: Left-skewed distribution, indicating most players have high potential.  
Wage (EUR): Right-skewed distribution with the majority earning lower wages.  
Value Distribution (EUR): Highly right-skewed, indicating most players have lower market values, with a few exceptions with very high values.  
Height Distribution: Appears roughly normally distributed, centering around a common height for players, which seems to be between 170-190 cm.  
Weight Distribution: Slightly right-skewed, with a peak suggesting there's a common range where most players' weights fall, likely around 70-80 kg.  
Pace Distribution: Multi-modal distribution with several peaks, which could indicate that players tend to cluster around specific pace attributes.  
shooting, dribbling, and passing Distribution: Roughly normally distributed, with most players exhibiting average abilities in these areas. We can also infer that players tend to have a balanced skill set across these skills  
Defending Distribution: The defending skill distribution shows several peak.  
Physic Distribution: This distribution is multimodal  

##### b. Distribution  

**Distribution based on Age and Position**  

```{r}
g_age <- ggplot(fifa, aes(x = age)) 
final_plot <- g_age + 
  geom_density(aes(fill = attack_position, color = "orange"), alpha = 0.5) + 
  facet_grid(. ~ attack_position) + 
  ggtitle("Distribution based on Age and Position") +
  labs(x = "Age", y = "Density") +
  theme_minimal()
print(final_plot)
```

The plot shows that the most common age for FIFA players, regardless of their position, is in the late 20s. The distributions are fairly similar across the different positions, with no notable outliers or significant differences in age ranges between positions.  


**Distribution based on Age and League**  

```{r}
final_plot <- ggplot(fifa, aes(x = age, fill = attack_position)) + 
  geom_density(alpha = 0.5) +  # Apply alpha for transparency
  facet_wrap(~ league_name 
             )+  # Facet by league_name
  ggtitle("Age Distribution by Attack Position Across Leagues") +
  labs(x = "Age", y = "Density") +
  theme_minimal() +
  theme(legend.position = "bottom")  # Adjust legend position if needed

# Print the final plot
print(final_plot)
```

Player age distributions in these football leagues are generally centered around the mid to late 20s. Overall, midfielders and attackers tend to be younger.Goalkeepers tend to have a right-shifted distribution, suggesting they peak at older ages compared to outfield players.
The distribution in the Italian Serie A seems to be slightly skewed towards older ages compared to the other leagues.  
Spanish Primera Division displays a bimodal distribution for Goalkeeper and attack positions, suggesting there is a peak with younger players and a second peak with experienced players.  


**Best Players by Position Using Overall Ratings**  

```{r fig.show='asis',results='hide'}
# Attack Players
attack_players <- fifa %>%
  filter(attack_position == "Attack") %>%
  arrange(desc(overall)) %>%
  slice_head(n=6)

# Midfield Players
midfield_players <- fifa %>%
  filter(attack_position == "Midfield") %>%
  arrange(desc(overall)) %>%
  slice_head(n=6)

# Goalkeeper Players
goalkeeper_players <- fifa %>%
  filter(attack_position == "GoalKeeper") %>%
  arrange(desc(overall)) %>%
  slice_head(n=6)

# Defense Players
defense_players <- fifa %>%
  filter(attack_position == "Defense") %>%
  arrange(desc(overall)) %>%
  slice_head(n=6)

# Generate the plots
# For Attack Players
p_attack <- ggplot(attack_players, aes(x = reorder(rownames(attack_players), overall), y = overall, fill = overall)) +
  geom_col() +
  coord_flip() +
  geom_text(aes(label = overall), hjust = 1.1, size = 3) +
  labs(title = "Top 6 Attack Players", x = "Player", y = "Overall Rating") +
  scale_fill_gradient(low = "lightblue", high = "blue") +
  theme_minimal() +
  theme(plot.margin = margin(t=5, r=25, b=5, l=5, unit="pt"))

# For Midfield Players
p_midfield <- ggplot(midfield_players, aes(x = reorder(rownames(midfield_players), overall), y = overall, fill = overall)) +
  geom_col() +
  coord_flip() +
  geom_text(aes(label = overall), hjust = 1.1, size = 3) +
  labs(title = "Top 6 Midfield Players", x = "Player", y = "Overall Rating") +
  scale_fill_gradient(low = "lightblue", high = "blue") +
  theme_minimal() +
  theme(plot.margin = margin(t=5, r=25, b=5, l=5, unit="pt"))

# For Goalkeeper Players
p_goalkeeper <- ggplot(goalkeeper_players, aes(x = reorder(rownames(goalkeeper_players), overall), y = overall, fill = overall)) +
  geom_col() +
  coord_flip() +
  geom_text(aes(label = overall), hjust = 1.1, size = 3) +
  labs(title = "Top 6 Goalkeeper Players", x = "Player", y = "Overall Rating") +
  scale_fill_gradient(low = "lightblue", high = "blue") +
  theme_minimal() +
  theme(plot.margin = margin(t=5, r=25, b=5, l=5, unit="pt"))

# For Defense Players
p_defense <- ggplot(defense_players, aes(x = reorder(rownames(defense_players), overall), y = overall, fill = overall)) +
  geom_col() +
  coord_flip() +
  geom_text(aes(label = overall), hjust = 1.1, size = 3) +
  labs(title = "Top 6 Defense Players", x = "Player", y = "Overall Rating") +
  scale_fill_gradient(low = "lightblue", high = "blue") +
  theme_minimal() +
  theme(plot.margin = margin(t=5, r=25, b=5, l=5, unit="pt"))

# Combine all plots into a grid
grid_plot <- grid.arrange(p_attack, p_midfield, p_goalkeeper, p_defense, nrow = 2, ncol = 2)

# Print the grid plot
print(grid_plot)

```

**Best clubs based on overall rating**  

```{r}
# Calculate the average overall rating for each club
club_ratings <- fifa %>%
  group_by(league_name, club_name) %>%
  summarise(average_rating = mean(overall, na.rm = TRUE)) %>%
  arrange(desc(average_rating))

# Now select the top 5 clubs per league based on their average rating
top_clubs_per_league <- club_ratings %>%
  group_by(league_name) %>%
  top_n(5, average_rating)

# Optional: Create a visual representation
ggplot(top_clubs_per_league, aes(x = reorder(club_name, average_rating), y = average_rating, fill = league_name)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ league_name, scales = "free") +
  theme_minimal() +
  labs(title = "Top 5 Clubs by Average Overall Rating per League",
       x = "Club Name",
       y = "Average Overall Rating") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

**Best Players by League Using Overall Ratings**  

```{r}

fifa <- fifa %>%
  tibble::rownames_to_column(var = "player_name")

# Find the best players by league based on overall ratings
best_players_by_league <- fifa %>%
  arrange(desc(overall)) %>%
  group_by(league_name) %>%
  slice_head(n = 5) %>%
  ungroup()

# Visualize the best players by league
ggplot(best_players_by_league, aes(x = reorder(player_name, overall), y = overall, fill = league_name)) +
  geom_col() +
  coord_flip() + 
  facet_wrap(~ league_name, scales = "free_y") +
  theme_minimal() +
  labs(title = "Top 5 Players by Overall Rating in Each League",
       x = "Player",
       y = "Overall Rating") +
  theme(legend.position = "bottom",
        axis.text.y = element_text(angle = 0, hjust = 1)) 

```

##### c. Scatterplot  


```{r, warning=FALSE, message=FALSE}

fifa.num.inGK.market <- fifa.num.inGK[, c("value_eur", "overall", "wage_eur", "age", "potential")]

# Enhanced pair plot
ggpairs(fifa.num.inGK.market, 
        upper = list(continuous = wrap("points", alpha = 0.7, size = 1.5)),
        lower = list(continuous = wrap("smooth", method = "lm", color = "blue", alpha = 0.7)),
        diag = list(continuous = wrap("barDiag")),
        axisLabels = "show",
        progress = FALSE
) + theme_minimal() +
    theme(
      legend.position = "bottom",
      axis.text.x = element_text(angle = 45, hjust = 1),
      plot.background = element_rect(fill = "white")
    )

```
Market Value and Overall Rating (value_eur vs. overall): There's a clear positive correlation. Higher-rated players tend to have a higher market value.  

Wage and Overall Rating (wage_eur vs. overall): Similarly, there's a positive correlation, indicating players with higher overall ratings command higher wages.  

Age and Other Variables (age vs. other variables): Age does not show a strong linear relationship with market value or wages, suggesting that peak market value and wages may be achieved at different ages. There might be a slight negative relationship between age and potential, indicating that younger players generally have higher potential ratings.  

Potential and Overall Rating (potential vs. overall): There's a strong positive correlation, meaning players with high potential ratings also tend to have high overall ratings.  

Market Value and Wage (value_eur vs. wage_eur): These two financial aspects show a positive correlation, suggesting that players with high market values also tend to have high wages.  

##### d. Outliers  

Below is the box plot for numerical columns to view the outliers.  

```{r}
ggplot(gather(fifa.num.exGK), aes(value)) +
  geom_boxplot(outlier.colour="skyblue") +
  facet_wrap(~ key, scales = "free") +
  labs(title = "Histograms of Numerical Columns for FIFA dataset", x = "Value", y = "Frequency")
```

*Interpretation*  

-value_eur & wage_eur has lot of significant outliers detected and is left skewed.  

-Defending & shooting sees a large whisker and has a greater spreadness than the overall data.  

-dribbling, height_cm, overall, pace, passing, physic, potential & weight_kg has few outliers and is mostly normalized with median mostly towards center indicating data is equally divided.  

**Outliers Percentage**  

```{r}
for (col in names(fifa.num.exGK)) {
  IQR_value <- IQR(fifa.num.exGK[[col]])
  outliers <- which(fifa.num.exGK[[col]] < (quantile(fifa.num.exGK[[col]])[2] - 1.5 * IQR_value) |
                      fifa.num.exGK[[col]] > (quantile(fifa.num.exGK[[col]])[4] + 1.5 * IQR_value))
  outlier_percentage <- round(length(outliers) / nrow(fifa.num.exGK) * 100,2)
  cat("Variable:", col, "\n")
  cat("Percentage of outliers:", outlier_percentage, "%\n\n")
}
```
We decided to keep everything as they are valid values and reflect the market   

### b. Multivariate Analysis  

#### i. Correlation  

```{r}
correlation_matrix <- cor(fifa.num, use = "complete.obs")

corrplot(correlation_matrix, method = "circle", 
         type = "upper",                     
         order = "hclust",                  
         tl.col = "black",                  
         tl.srt = 45,                       
         addCoef.col = "black",             
         number.cex = 0.5,                  
         tl.cex = 0.6,                      
         diag = FALSE)                      
```
Overall and Potential: There is a strong positive correlation (0.76) between a player's overall rating and their potential, suggesting that players with high current ratings are also likely to have high potential ratings.  

Value and Wages: The market value (value_eur) and wages (wage_eur) of players have a very strong positive correlation with each other (0.81) and with the overall rating (0.80 and 0.77, respectively), indicating that players with higher skills and performance ratings tend to have higher market values and command higher salaries.  

Physical Attributes and Skills: There is a negative correlation between height and skills associated with speed and agility, such as pace, dribbling, and passing.May be because taller players (often defenders or goalkeepers) may not be as fast or agile as shorter players (often midfielders or attackers).  

Skills Interrelationship: Skill-related attributes such as pace, shooting, passing, and dribbling show very high positive correlations with each other, particularly passing and dribbling (0.97).  

#### ii. Multicollinearity  

```{r}
lm_model <- lm(overall ~., data = fifa.num)

# Step 2: Calculate VIF
vif_values <- vif(lm_model)

# Print the VIF values
print(vif_values)
```
Dribbling indicates high multicollinearity and shooting and passing shows moderate multicollinearity.  


## 5.	EDA on Categorical Variables  

### Univariate and Multivariate Analysis  

```{r}
fifa$international_reputation_factor <- cut(fifa$international_reputation,
                                            breaks = c(0, 1, 3, 5),
                                            labels = c("Low", "Average", "Excellent"),
                                            include.lowest = TRUE)
fifa.exGK$international_reputation_factor <- cut(fifa.exGK$international_reputation,
                                            breaks = c(0, 1, 3, 5),
                                            labels = c("Low", "Average", "Excellent"),
                                            include.lowest = TRUE)
fifa.inGK$international_reputation_factor <- cut(fifa.inGK$international_reputation,
                                            breaks = c(0, 1, 3, 5),
                                            labels = c("Low", "Average", "Excellent"),
                                            include.lowest = TRUE)
```



#### i. Preferred Foot  

```{r}
# proportion of preferred_foot
perct_preferred_foot <- fifa %>%
  group_by(preferred_foot) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
#perct_preferred_foot

ggplot(perct_preferred_foot, aes(x="", y=perct, fill=preferred_foot)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,2), "%")), position = position_stack(vjust=0.5)) +
  labs(title = "Preferred Foot Percentage", x = "Foot", y = "%", fill = NULL) + 
  theme_void() #remove grid
```

Around 25% of the players are using predominantly their left foot. This is high compared to that around 12% of the world population is left handed.  

**Barplot for Preferred Foot per League**  (using barplot)  

```{r}
# Two-way table
foot_table <- table(fifa$preferred_foot,fifa$league_name)
foot_table
barplot(foot_table, xlab="Preferred foot", ylab="Frequency", args.legend= list(x="topright", inset=c(-0.05,0)),  col=c("lightblue","lightgreen"), beside=TRUE, main="Preferred foot of players in each league", cex.names = 0.8)
```

**Barplot for Preferred Foot per League**  (using ggplot)  

```{r}
# Two-way table
foot_table <- table(fifa$preferred_foot,fifa$league_name)
#foot_table
foot_df <- as.data.frame(foot_table)
colnames(foot_df) <- c("preferred_foot", "league_name", "frequency")
#head(foot_df)

ggplot(data = foot_df, aes(x = league_name, y = frequency, fill = preferred_foot)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7, show.legend=TRUE) +
  labs(x = "Preferred foot", y = "Frequency", title = "Preferred foot of players in each league") +
  scale_fill_brewer(palette = "Set1")   # Use color palette Set1
#  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) # specify colors manually
```
No difference between leagues.  

#### ii. Body Type  

```{r}
# proportion of body_type
perct_body_type <- fifa %>%
  group_by(body_type) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
#perct_body_type

ggplot(perct_body_type, aes(x="", y=perct, fill=body_type)) +
  geom_bar(stat="identity", width=1, just=0.8) +
  coord_polar(theta="y", start=0, direction = -1) + #makes it pie chart, direction -1 rotate to the right
  geom_text(aes(label = paste0(round(perct,2), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "Body type Percentage", x = "Body type", y = "%", fill = NULL) + 
  theme_void() #remove grid
```

#### iii. Simplified Body Type  

```{r}
#extract 4 first char of body type
fifa$simple_body_type <- substr(fifa$body_type,1,4)

# proportion of body_type
perct_simple_body_type <- fifa %>%
  group_by(simple_body_type) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_simple_body_type

ggplot(perct_simple_body_type, aes(x="", y=perct, fill=simple_body_type)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,2), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "Body type Percentage", x = "Body type (simplified)", y = "%", fill = NULL) + 
  theme_void() #remove grid
```
Over 50% of the players have a normal body type. Note that almost 10% (9.43%) have a Unique body type.  

**Simplified Body Type per League**

```{r}
#extract 4 first char of body type
fifa.eng$simple_body_type <- substr(fifa.eng$body_type,1,4)
fifa.fra$simple_body_type <- substr(fifa.fra$body_type,1,4)
fifa.ita$simple_body_type <- substr(fifa.ita$body_type,1,4)
fifa.spn$simple_body_type <- substr(fifa.spn$body_type,1,4)

# proportion of body_type
perct_simple_body_type.eng <- fifa.eng %>%
  group_by(simple_body_type) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_simple_body_type.fra <- fifa.fra %>%
  group_by(simple_body_type) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_simple_body_type.ita <- fifa.ita %>%
  group_by(simple_body_type) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_simple_body_type.spn <- fifa.spn %>%
  group_by(simple_body_type) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
#perct_simple_body_type.eng
#perct_simple_body_type.fra
#perct_simple_body_type.ita
#perct_simple_body_type.spn

p1 <- ggplot(perct_simple_body_type.eng, aes(x="", y=perct, fill=simple_body_type)) +
  geom_bar(stat="identity", width=1, just=0.8, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  labs(title = "Body type English Premier League", x = "Body type (simplified)", y = "%", fill = NULL) + 
  theme_void() #remove grid

p2 <- ggplot(perct_simple_body_type.fra, aes(x="", y=perct, fill=simple_body_type)) +
  geom_bar(stat="identity", width=1, just=0.8, show.legend =TRUE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  labs(title = "Body type French Ligue 1", x = "Body type (simplified)", y = "%", fill = NULL) + 
  theme_void() #remove grid

p3 <- ggplot(perct_simple_body_type.ita, aes(x="", y=perct, fill=simple_body_type)) +
  geom_bar(stat="identity", width=1, just=0.8, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  labs(title = "Body type Italian Serie A", x = "Body type (simplified)", y = "%", fill = NULL) + 
  theme_void() #remove grid

p4 <- ggplot(perct_simple_body_type.spn, aes(x="", y=perct, fill=simple_body_type)) +
  geom_bar(stat="identity", width=1, just=0.8, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  labs(title = "Body type Spain Primera Division", x = "Body type (simplified)", y = "%", fill = NULL) + 
  theme_void() #remove grid

# Combine plots
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)

```

There are more players with Unique body type and less players with normal body type in English league than in the other leagues.  

#### iv. International Reputation

```{r}
fifa$international_reputation <- as.factor(fifa$international_reputation)
# proportion of international_reputation
perct_international_reputation <- fifa %>%
  group_by(international_reputation) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_international_reputation

ggplot(perct_international_reputation, aes(x="", y=perct, fill=international_reputation)) +
  geom_bar(stat="identity", width=3, just=0.9) +
  coord_polar(theta="y", start=0, direction = -1) + #makes it pie chart, direction -1 rotate to the right
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "International reputation Percentage", x = "International reputation", y = "%", fill = NULL) + 
  theme_void() #remove grid

```
Only 0.6% of the players have an international reputation of 5, the highest.  
50.7% of the players of all 4 leagues have a low international reputation of 1.  

**Barplot for international reputation per league**  (using ggplot)
```{r}
# Two-way table
reputation_table <- table(fifa$international_reputation,fifa$league_name)
#reputation_table
reputation_df <- as.data.frame(reputation_table)
colnames(reputation_df) <- c("international_reputation", "league_name", "frequency")
head(reputation_df)

ggplot(data = reputation_df, aes(x = league_name, y = frequency, fill = international_reputation)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7, show.legend=TRUE) +
  labs(x = "International reputation", y = "Frequency", title = "International reputation of players in each league") +
  scale_fill_brewer(palette = "Set1")   # Use color palette Set1
#  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) # specify colors manually
```

**Piechart of international reputation per League**
```{r}
#extract 4 first char of International reputation
fifa.eng$international_reputation <- as.factor(fifa.eng$international_reputation)
fifa.fra$international_reputation <- as.factor(fifa.fra$international_reputation)
fifa.ita$international_reputation <- as.factor(fifa.ita$international_reputation)
fifa.spn$international_reputation <- as.factor(fifa.spn$international_reputation)

# proportion of international_reputation
perct_international_reputation.eng <- fifa.eng %>%
  group_by(international_reputation) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_international_reputation.fra <- fifa.fra %>%
  group_by(international_reputation) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_international_reputation.ita <- fifa.ita %>%
  group_by(international_reputation) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_international_reputation.spn <- fifa.spn %>%
  group_by(international_reputation) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_international_reputation.eng
perct_international_reputation.fra
perct_international_reputation.ita
perct_international_reputation.spn

p1 <- ggplot(perct_international_reputation.eng, aes(x="", y=perct, fill=international_reputation)) +
  geom_bar(stat="identity", width=1, just=0.9) +
  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +   # Use color palette Set1
  labs(title = "International reputation English Premier League", x = "International reputation", y = "%", fill = NULL) + 
  theme_void() #remove grid

p2 <- ggplot(perct_international_reputation.fra, aes(x="", y=perct, fill=international_reputation)) +
  geom_bar(stat="identity", width=1, just=0.9) +
  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "International reputation French Ligue 1", x = "International reputation", y = "%", fill = NULL) + 
  theme_void() #remove grid

p3 <- ggplot(perct_international_reputation.ita, aes(x="", y=perct, fill=international_reputation)) +
  geom_bar(stat="identity", width=1, just=0.9) +
  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "International reputation Italian Serie A", x = "International reputation", y = "%", fill = NULL) + 
  theme_void() #remove grid

p4 <- ggplot(perct_international_reputation.spn, aes(x="", y=perct, fill=international_reputation)) +
  geom_bar(stat="identity", width=1, just=0.9) +
  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "International reputation Spain Primera Division", x = "International reputation", y = "%", fill = NULL) + 
  theme_void() #remove grid

# Combine plots
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)

```

The Italian league doesn't have any player with the highest international reputation (5).  
The Spanish league has the most players with high international reputation (4,5 : 5.9% + 0.9%).  

#### v. Age Groups

**Barplot for age group per league**  (using barplot)
From summary, age is between 17 and 39.
```{r}
# create age groups
fifa$age_group <- cut(x = fifa$age, breaks = seq(from = 15, to = 40, by = 5))
# Two-way table
age_table <- table(fifa$age_group,fifa$league_name)
#age_table
barplot(age_table, xlab="Age group", ylab="Frequency", legend.text=c("<=20", "21-25", "26-30","31-35","35-40"), args.legend= list(x="topright", inset=c(-0.05,0)),  col=c("darkblue","blue","lightblue","lightgreen","green"), beside=TRUE, main="Age of players in each league", cex.names = 0.8)
```

**Barplot for age group per league**  (using ggplot)
From summary, age is between 17 and 39 
```{r}
# create age groups
fifa$age_group <- cut(x = fifa$age, breaks = seq(from = 15, to = 40, by = 5))
# Two-way table
age_table <- table(fifa$age_group,fifa$league_name)
age_table
age_df <- as.data.frame(age_table)
colnames(age_df) <- c("age_group", "league_name", "frequency")
head(age_df)

ggplot(data = age_df, aes(x = league_name, y = frequency, fill = age_group)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7, show.legend=TRUE) +
  labs(x = "Age group", y = "Frequency", title = "Age of players in each league") +
  scale_fill_brewer(palette = "Set1")   # Use color palette Set1
#  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) # specify colors manually
```

There is a small tendency of having younger players in the French league and older players (>30 years) in the spanish league.  

#### vi. Height Groups

```{r}
# create height groups
fifa$height_group <- cut(x = fifa$height_cm, breaks = seq(from = 160, to = 210, by = 10))

# proportion of height group
perct_height_group <- fifa %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
#perct_height_group

ggplot(perct_height_group, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9) +
  coord_polar(theta="y", start=0, direction = -1) + #makes it pie chart, direction -1 rotate to the right
  geom_text(aes(label = paste0(round(perct,2), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "Height group Percentage", x = "Height group", y = "%", fill = NULL) + 
  theme_void() #remove grid
```
A very large majority of the players are between 1.70m and 1.90m. There is only 1 player across the 4 leagues who is taller than 2m.  

**Barplot for height group per league** (using barplot)
From summary, height_cm is between 163 and 202 
```{r}
# create height groups
fifa$height_group <- cut(x = fifa$height_cm, breaks = seq(from = 160, to = 210, by = 10))
# Two-way table
height_table <- table(fifa$height_group,fifa$league_name)
height_table

barplot(height_table, xlab="Height group", ylab="Frequency", legend.text=c("<=170", "170-180", "180-190","190-200",">200"), args.legend= list(x="topright", inset=c(-0.05,0)),  col=c("darkblue","blue","lightblue","lightgreen","green"), beside=TRUE, main="Height of players in each league", cex.names = 0.8)
```

**Barplot for height group per league** (using ggplot)
From summary, height_cm is between 163 and 202
```{r}
# create height groups
fifa$height_group <- cut(x = fifa$height_cm, breaks = seq(from = 160, to = 210, by = 10))
# Two-way table
height_table <- table(fifa$height_group,fifa$league_name)
height_table
height_df <- as.data.frame(height_table)
colnames(height_df) <- c("height_group", "league_name", "frequency")
head(height_df)

ggplot(data = height_df, aes(x = league_name, y = frequency, fill = height_group)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7, show.legend=TRUE) +
  labs(x = "Height group", y = "Frequency", title = "Height of players in each league") +
  scale_fill_brewer(palette = "Set1")   # Use color palette Set1
#  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) # specify colors manually
```

**Stacked plot of height groups per League**
```{r}
# create height groups
fifa.eng$height_group <- cut(x = fifa.eng$height_cm, breaks = seq(from = 160, to = 210, by = 10))
fifa.fra$height_group <- cut(x = fifa.fra$height_cm, breaks = seq(from = 160, to = 210, by = 10))
fifa.ita$height_group <- cut(x = fifa.ita$height_cm, breaks = seq(from = 160, to = 210, by = 10))
fifa.spn$height_group <- cut(x = fifa.spn$height_cm, breaks = seq(from = 160, to = 210, by = 10))

# proportion of height_group
perct_height_group.eng <- fifa.eng %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_height_group.fra <- fifa.fra %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_height_group.ita <- fifa.ita %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_height_group.spn <- fifa.spn %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_height_group.eng
perct_height_group.fra
perct_height_group.ita
perct_height_group.spn

p1 <- ggplot(perct_height_group.eng, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "Height group English Premier League", x = "Height group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p2 <- ggplot(perct_height_group.fra, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "Height group French Ligue 1", x = "Height group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p3 <- ggplot(perct_height_group.ita, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =TRUE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "Height group Italian Serie A", x = "Height group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p4 <- ggplot(perct_height_group.spn, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "Height group Spain Primera Division", x = "Height group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

# Combine plots
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)

```

There is a slightly larger proportion of taller players in the Italian league with height above 1.80m.    


** Height group per league (using ggplot, stat_bin)
**NOT NEEDED?**
```{r}
ggplot(fifa, aes(x = height_cm, fill = league_name)) + 
  geom_bar(position = "fill", width=1) + 
  labs(title = "Frequency of height by League", x = "Height groups", y = "Frequency") +
  stat_bin(bins=5, width = 0.8) +
#  geom_text(aes(label = paste0(round(percentage,1), "%")), position = position_stack(vjust=0.5)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


**Frequency of height group per League**
```{r}
ggplot(fifa, aes(x = league_name, fill = height_group)) + 
  geom_bar(position = "fill", width=1) + 
  labs(title = "Frequency of height by League", x = "League Name", y = "Frequency") +
  stat_count(width = 0.8) +
#  geom_text(aes(label = count(identity))) +
#  geom_text(aes(label = paste0(round(percentage),1), "%")), position = position_stack(vjust=0.5)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Barplot for height group per position** (using barplot)
From summary, height_cm is between 163 and 202 
```{r}
# create height group
fifa$height_group <- cut(x = fifa$height_cm, breaks = seq(from = 160, to = 210, by = 10))
# Two-way table
height_table <- table(fifa$height_group,fifa$attack_position)
height_table

barplot(height_table, xlab="Height groups", ylab="Frequency", legend.text=c("<=170", "170-180", "180-190","190-200",">200"), args.legend= list(x="topright", inset=c(-0.05,0)),  col=c("darkblue","blue","lightblue","lightgreen","green"), beside=TRUE, main="Height of players per position type", cex.names = 0.8)
```

**Stacked plot of height groups per Position**
```{r}
# create height groups
fifa.att$height_group <- cut(x = fifa.att$height_cm, breaks = seq(from = 160, to = 210, by = 10))
fifa.mid$height_group <- cut(x = fifa.mid$height_cm, breaks = seq(from = 160, to = 210, by = 10))
fifa.def$height_group <- cut(x = fifa.def$height_cm, breaks = seq(from = 160, to = 210, by = 10))
fifa.gok$height_group <- cut(x = fifa.gok$height_cm, breaks = seq(from = 160, to = 210, by = 10))

# proportion of height_group
perct_height_group.att <- fifa.att %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_height_group.mid <- fifa.mid %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_height_group.def <- fifa.def %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_height_group.gok <- fifa.gok %>%
  group_by(height_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_height_group.att
perct_height_group.mid
perct_height_group.def
perct_height_group.gok

p1 <- ggplot(perct_height_group.att, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "Height group Attackers", x = "Height group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p2 <- ggplot(perct_height_group.mid, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =TRUE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "Height group Midfielders", x = "Height group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p3 <- ggplot(perct_height_group.def, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "Height group Defenders", x = "Height group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p4 <- ggplot(perct_height_group.gok, aes(x="", y=perct, fill=height_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =TRUE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "Height group Goal keepers", x = "Height group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c( "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

# Combine plots
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)

```

There is no Goal keepers under 1.70m, and a large majority is taller than the other positions.  
The defenders tend to be taller than the attackers and the midfielders.  

#### vii. Position

**Barplot of players per position** (using barplot)
```{r}
# Two-way table
attack_table <- table(fifa$league_name,fifa$attack_position)
attack_table
barplot(attack_table, xlab="Leagues", ylab="Frequency", legend.text=c("ENG","FRA","ITA","SPN"), args.legend= list(x="topleft", inset=c(0.05,0)),  col=c("darkblue","blue","lightblue","lightgreen"), beside=TRUE, main="Player's position per league", cex.names = 0.8)
```
Italian league seems to have a little bit more attackers and less defenders than the 3 other leagues. English league has the most defenders.  
Each league has the same amount of Goal keepers, 1 per team, 20 per league.  


#### viii. Weight Groups
```{r}
# create weight groups
fifa$weight_group <- cut(x = fifa$weight_kg, breaks = seq(from = 55, to = 105, by = 10))

# proportion of weight group
perct_weight_group <- fifa %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
#perct_weight_group

ggplot(perct_weight_group, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9) +
  coord_polar(theta="y", start=0, direction = -1) + #makes it pie chart, direction -1 rotate to the right
  geom_text(aes(label = paste0(round(perct,2), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "Weight group Percentage", x = "Weight group", y = "%", fill = NULL) + 
  theme_void() #remove grid
```

**Barplot for weight group per league**  (using barplot)
From summary, weight_kg is between 58 and 100 
```{r}
# create weight groups
fifa$weight_group <- cut(x = fifa$weight_kg, breaks = seq(from = 55, to = 105, by = 10))
# Two-way table
weight_table <- table(fifa$weight_group,fifa$league_name)
weight_table


barplot(weight_table, xlab="weight groups", ylab="Frequency", legend.text=c("<=65", "65-75", "75-85","85-95",">95"), args.legend= list(x="topright", inset=c(-0.05,0)),  col=c("darkblue","blue","lightblue","lightgreen","green"), beside=TRUE, main="Weight of players in each league", cex.names = 0.8)
```

**Stacked barplot of weight groups per League** (using ggplot)
From summary, weight_kg is between 58 and 100 
```{r}
# create weight groups
fifa.eng$weight_group <- cut(x = fifa.eng$weight_kg, breaks = seq(from = 55, to = 105, by = 10))
fifa.fra$weight_group <- cut(x = fifa.fra$weight_kg, breaks = seq(from = 55, to = 105, by = 10))
fifa.ita$weight_group <- cut(x = fifa.ita$weight_kg, breaks = seq(from = 55, to = 105, by = 10))
fifa.spn$weight_group <- cut(x = fifa.spn$weight_kg, breaks = seq(from = 55, to = 105, by = 10))

# proportion of weight_group
perct_weight_group.eng <- fifa.eng %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_weight_group.fra <- fifa.fra %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_weight_group.ita <- fifa.ita %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_weight_group.spn <- fifa.spn %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_weight_group.eng
perct_weight_group.fra
perct_weight_group.ita
perct_weight_group.spn

p1 <- ggplot(perct_weight_group.eng, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =TRUE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "weight group English Premier League", x = "weight group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p2 <- ggplot(perct_weight_group.fra, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "weight group French Ligue 1", x = "weight group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p3 <- ggplot(perct_weight_group.ita, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "weight group Italian Serie A", x = "weight group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p4 <- ggplot(perct_weight_group.spn, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "weight group Spain Primera Division", x = "weight group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

# Combine plots
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)
```


**Barplot for weight group per position**  (using barplot)
From summary, weight_kg is between 58 and 100 
```{r}
# create weight groups
fifa$weight_group <- cut(x = fifa$weight_kg, breaks = seq(from = 55, to = 105, by = 10))
# Two-way table
weight_table <- table(fifa$weight_group,fifa$attack_position)
weight_table

barplot(weight_table, xlab="weight groups", ylab="Frequency", legend.text=c("<=65", "65-75", "75-85","85-95",">95"), args.legend= list(x="topright", inset=c(-0.05,0)),  col=c("darkblue","blue","lightblue","lightgreen","green"), beside=TRUE, main="Weight of players per type of position", cex.names = 0.8)
```

**Stacked barplot of weight groups per position**
```{r}
# create weight groups
fifa.att$weight_group <- cut(x = fifa.att$weight_kg, breaks = seq(from = 55, to = 105, by = 10))
fifa.mid$weight_group <- cut(x = fifa.mid$weight_kg, breaks = seq(from = 55, to = 105, by = 10))
fifa.def$weight_group <- cut(x = fifa.def$weight_kg, breaks = seq(from = 55, to = 105, by = 10))
fifa.gok$weight_group <- cut(x = fifa.gok$weight_kg, breaks = seq(from = 55, to = 105, by = 10))

# proportion of weight_group
perct_weight_group.eng <- fifa.att %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_weight_group.fra <- fifa.mid %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_weight_group.ita <- fifa.def %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_weight_group.spn <- fifa.gok %>%
  group_by(weight_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_weight_group.eng
perct_weight_group.fra
perct_weight_group.ita
perct_weight_group.spn

p1 <- ggplot(perct_weight_group.eng, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "weight group Attacker", x = "weight group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p2 <- ggplot(perct_weight_group.fra, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "weight group Midfielder", x = "weight group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p3 <- ggplot(perct_weight_group.ita, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =TRUE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "weight group Defender", x = "weight group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

p4 <- ggplot(perct_weight_group.spn, aes(x="", y=perct, fill=weight_group)) +
  geom_bar(stat="identity", width=1, just=0.9, show.legend =FALSE) +
#  coord_polar("y", start=0, direction=-1) + #makes it pie chart
  geom_text(aes(label = paste0(round(perct,1), "%")), color="white", position = position_stack(vjust=0.5)) +
  labs(title = "weight group Goal keeper", x = "weight group", y = "%", fill = NULL) + 
  scale_fill_manual(values = c("darkblue", "blue", "lightblue", "lightgreen", "green")) + # specify colors manually  
  theme_void() #remove grid

# Combine plots
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)
```

There is no heavier players in the Attacker and Midfielder groups (>95kg). There is no lighter players in the Goal keeper group (<65kg).  

#### ix. Wage Groups

**Barplot for Salary range per club in each league**  
From summary, salary is between 550 and 350000 
```{r}
# create wage range
fifa.eng$wage_group <- cut(x = fifa.eng$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa.eng$wage_group,fifa.eng$club_name)
#wage_table

barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225",">225"), args.legend= list(x="topright", inset=c(-0.08,0)),  col=c("darkblue","blue","lightblue","lightgreen"), main="wage of players per club", cex.names = 0.7, las = 2)
```


```{r}
# create wage groups
fifa.fra$wage_group <- cut(x = fifa.fra$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa.fra$wage_group,fifa.fra$club_name)
#wage_table
barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225",">225"), args.legend= list(x="topright", inset=c(-0.08,0)),  col=c("darkblue","blue","lightblue","lightgreen"), main="Wage of players per club", cex.names = 0.7, las=2)
```


```{r}
# create wage groups
fifa.ita$wage_group <- cut(x = fifa.ita$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa.ita$wage_group,fifa.ita$club_name)
#wage_table
barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225",">225"), args.legend= list(x="topright", inset=c(-0.08,0)),  col=c("darkblue","blue","lightblue","lightgreen"), main="Wage of players per club", cex.names = 0.7, las=2)
```

In the italian league 1 club (Inter) is paying all of their players above 75,000 euros.  


```{r}
# create wage group
fifa.spn$wage_group <- cut(x = fifa.spn$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa.spn$wage_group,fifa.spn$club_name)
wage_table
barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225","225-300",">300"), args.legend= list(x="topright", inset=c(-0.08,0)),  col=c("darkblue","blue","lightblue","lightgreen","green"), main="wage of players per club", cex.names = 0.7, las=2)
```
In the spanish League 2 clubs have highly paid players: Real Madrid and FC Barcelona. Those clubs are known to be successful and participating regularly in european competitions.  

Comparing the 4 leagues, the best paid players are in the English league.  

**Barplot for Salary range per club in each league**  
From summary, salary is between 550 and 350000 
###### a. Same as above 4 graphs in 1 page
```{r}
# several plots in 1 page 
opar <- par(mfrow = c(2, 2)) # 2 row x 2 columns , 2 plots side by side

# create wage range
fifa.eng$wage_group <- cut(x = fifa.eng$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa.eng$wage_group,fifa.eng$club_name)
#wage_table

p1 <- barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225",">225"), args.legend= list(x="topright", inset=c(-0.08,0)),  col=c("darkblue","blue","lightblue","lightgreen"), main="wage of players per club", cex.names = 0.7, las = 2)

# create wage groups
fifa.fra$wage_group <- cut(x = fifa.fra$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa.fra$wage_group,fifa.fra$club_name)
#wage_table
p2 <- barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225",">225"), args.legend= list(x="topright", inset=c(-0.08,0)),  col=c("darkblue","blue","lightblue","lightgreen"), main="Wage of players per club", cex.names = 0.7, las=2)

# create wage groups
fifa.ita$wage_group <- cut(x = fifa.ita$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa.ita$wage_group,fifa.ita$club_name)
#wage_table
p3 <- barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225",">225"), args.legend= list(x="topright", inset=c(-0.08,0)),  col=c("darkblue","blue","lightblue","lightgreen"), main="Wage of players per club", cex.names = 0.7, las=2)

# create wage group
fifa.spn$wage_group <- cut(x = fifa.spn$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa.spn$wage_group,fifa.spn$club_name)
#wage_table
p4 <- barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225","225-300",">300"), args.legend= list(x="topright", inset=c(-0.08,0)),  col=c("darkblue","blue","lightblue","lightgreen","green"), main="wage of players per club", cex.names = 0.7, las=2)

# Combine plots DOESN'T WORK
#grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)

par(opar)

```









**Barplot for Salary range per position and league**  
From summary, salary is between 550 and 350000 
```{r}
# create wage groups
fifa$wage_group <- cut(x = fifa$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))
# Two-way table
wage_table <- table(fifa$wage_group,fifa$attack_position)
#wage_table

barplot(wage_table, xlab="wage groups", ylab="Frequency", legend.text=c("<=75", "75-150", "150-225",">225"), args.legend= list(x="topright", inset=c(-0.05,0)),  col=c("darkblue","blue","lightblue","lightgreen","green"), beside=TRUE, main="wage of players per type of position", cex.names = 0.8)
```
Most of the players are paid under 75,000 euros.
No goal keeper or defense player is highly paid in all 4 leagues.  

**Piechart for wage range**
```{r}
# create wage range
fifa$wage_group <- cut(x = fifa$wage_eur, breaks = seq(from = 0, to = 400000, by = 75000))

# proportion of wage group
perct_wage_group <- fifa %>%
  group_by(wage_group) %>%
  summarise (n = n()) %>%
  mutate(perct = n*100 / sum(n))
perct_wage_group

ggplot(perct_wage_group, aes(x="", y=perct, fill=wage_group)) +
  geom_bar(stat="identity", width=1, just=0.9) +
  coord_polar(theta="y", start=0, direction = -1) + #makes it pie chart, direction -1 rotate to the right
  geom_text(aes(label = paste0(round(perct,2), "%")), position = position_stack(vjust=0.5)) +
  scale_fill_brewer(palette = "Set1") +  # Use color palette Set1
  labs(title = "Wage group Percentage", x = "Wage group", y = "%", fill = NULL) + 
  theme_void() #remove grid
```
Large majority of players (81%) are paid under 75,000euros.  
Only 5 players are paid over 350,000euros across the 4 leagues.  

**Salary range per league** (using ggplot, stat_bin)
```{r}
ggplot(fifa, aes(x = wage_eur, fill = league_name)) + 
  geom_bar(position = "fill", width=1) + 
  labs(title = "Frequency of wage ranges by League", x = "Wage ranges", y = "Frequency") +
  stat_bin(bins=4, width = 0.8) +
#  geom_text(aes(label = paste0(round(percentage,1), "%")), position = position_stack(vjust=0.5)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
French league players are not in the higher salary range.  

**Salary range per position** (using ggplot, stat_bin)
```{r}
ggplot(fifa, aes(x = wage_eur, fill = attack_position)) + 
  geom_bar(position = "fill", width=1) + 
#  scale_fill_manual(values = c("blue", "purple", "violet","green"),
#                    labels = c("Att (1)", "Mid (2, 3)", "Def (4, 5)","GK")) +
  labs(title = "Frequency of wage ranges by Position", x = "Wage ranges", y = "Frequency") +
  stat_bin(bins=4, width = 0.8) +
#  geom_text(aes(label = paste0(round(percentage,1), "%")), position = position_stack(vjust=0.5)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

More attackers are in the higher salary range (>170,000 euros).   


#### x. Interaction between Nationalities, Clubs, and Reputation

```{r}
# proportion table
prop.table.fifa <- prop.table(table(fifa$international_reputation_factor, fifa$league_name), margin = 2)
prop.table.fifa

```
**Proportion of International Reputation by League**
```{r}
ggplot(fifa, aes(x = league_name, fill = international_reputation_factor)) + 
  geom_bar(position = "fill") + 
  scale_fill_manual(values = c("blue", "purple", "violet"),
                    labels = c("Low (1)", "Average (2, 3)", "Excellent (4, 5)")) +
  labs(title = "Proportion of International Reputation by League", 
       x = "League Name", 
       y = "Proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```
All four leagues have a similar distribution of international reputation, with the vast majority of players falling into the 'Low' reputation category. The 'Average' reputation group forms a substantial minority in each league. Also, the 'Excellent' category is the smallest segment for each league, highlighting the rarity of players who achieve the highest levels of international acclaim. 

This could indicate a high level of competition within the leagues, where only a few players achieve global recognition compared to the rest.

```{r}
# Identify top clubs for each league based on the number of players
top_clubs_per_league <- fifa %>%
  count(league_name, club_name) %>%
  arrange(desc(n)) %>%
  group_by(league_name) %>%
  slice_max(n, n = 20, with_ties = FALSE) %>%
  ungroup()

# Join fifa data frame with top clubs to filter the players from those clubs
fifa_top_clubs <- fifa %>%
  inner_join(top_clubs_per_league, by = c("league_name", "club_name"))

```


```{r}
kable(top_clubs_per_league)
```


### Comparative Analysis: To visualize Distribution of International Reputation in Top Clubs

```{r}
library(ggplot2)

leagues <- unique(fifa.inGK$league_name)

for (league in leagues) {
  # Filter and summarize the data for the current league
  league_data <- subset(fifa.inGK, league_name == league) %>%
    group_by(club_name, international_reputation) %>%
    summarise(count = n(), .groups = 'drop') # Ensure to drop grouping
  
  # Now create the heatmap with the summarized data
  p <- ggplot(league_data, aes(x = club_name, y = international_reputation, fill = count)) +
    geom_tile() +
    scale_fill_gradient(low = "blue", high = "red") +
    labs(title = paste("Heatmap of International Reputation in", league, "Clubs"),
         x = "Club Name",
         y = "International Reputation",
         fill = "Frequency") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
          plot.title = element_text(hjust = 0.5))
  
  print(p)
}

```
- French Ligue 1: Some clubs show a high frequency of players with an international reputation of 1, which is common across most clubs. Few clubs have players with a reputation of 4 or 5, indicating standout clubs in terms of player reputation.

- English Premier League: There is a greater distribution of international reputation across clubs, with several clubs having players with higher reputations. The frequency of players with a reputation of 1 is still high, but less so than in Ligue 1. This suggests a higher overall international profile for Premier League clubs.

- Spain Primera Division: Similar to the Premier League, there is a broad distribution of international reputation levels. Notably, there are clubs with a significant frequency of players with reputations at the highest levels, reflecting the strong international presence of some Spanish clubs.

- Italian Serie A: The distribution is somewhat varied, with many clubs having players with a reputation level of 1 or 2. The occurrence of players with the highest reputation is less frequent than in the Premier League or Primera Division, but some clubs still exhibit a notable number of highly reputed players.

Conclusion: The heatmaps indicate that *English Premier League* and *Spain's Primera Division* feature a wider spread of players with high international reputations compared to those in France's Ligue 1 and Italy's Serie A, suggesting these leagues' global reach and financial clout. 

### Correlation Analysis:Relationship between players' market value and wages within the leagues

```{r}
fifa_top_clubs$log_wage_eur <- log(fifa_top_clubs$wage_eur + 1)
fifa_top_clubs$log_value_eur <- log(fifa_top_clubs$value_eur + 1)

```

```{r}
# Calculate the IQR for wages
Q1 <- quantile(fifa_top_clubs$log_wage_eur, 0.25, na.rm = TRUE)
Q3 <- quantile(fifa_top_clubs$log_wage_eur, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1

# Define the upper bound for an outlier
upper_bound <- Q3 + 1.5 * IQR

# Create a new column to flag outliers
fifa_top_clubs$outlier <- fifa_top_clubs$log_wage_eur > upper_bound
```

```{r}
cor.test(fifa_top_clubs$wage_eur, fifa_top_clubs$value_eur, method = "pearson")

```
- There is a highly significant and strong positive correlation (r = 0.8088) between player wages and values in top clubs, with over 78% confidence that the true correlation lies between 0.7846 and 0.8305.

```{r}
# Calculate the correlation for each league
correlations <- fifa_top_clubs %>%
  group_by(league_name) %>%
  summarise(
    correlation = cor.test(wage_eur, value_eur, method = "pearson")$estimate,
    p_value = cor.test(wage_eur, value_eur, method = "pearson")$p.value
  ) %>%
  ungroup()
```

```{r}
print(correlations)
```

- English Premier League has the highest wage-value correlation (r = 0.8823) with extreme statistical significance (p < 2.6e-73).
- French Ligue 1 follows with a strong correlation (r = 0.8426) and significant results (p < 1.63e-60).
- Italian Serie A shows a strong correlation as well (r = 0.8032) with high significance (p < 5.94e-51).
- Spain Primera Division has the lowest yet still strong correlation (r = 0.7215) with significant p-value (p < 1.33e-36).

```{r}
# Calculate the IQR for wages
Q1 <- quantile(fifa_top_clubs$wage_eur, 0.25)
Q3 <- quantile(fifa_top_clubs$wage_eur, 0.75)
IQR <- Q3 - Q1

# Define the upper bound for an outlier
upper_bound <- Q3 + 1.5 * IQR

# Create a new column to flag outliers
fifa_top_clubs$outlier <- fifa_top_clubs$wage_eur > upper_bound

# Generate the scatter plot with colored outliers
ggplot(fifa_top_clubs, aes(x = value_eur, y = wage_eur, color = outlier)) +
  geom_point() +
  scale_color_manual(values = c("FALSE" = "black", "TRUE" = "orange")) + # Color non-outliers black and outliers red
  facet_wrap(~league_name) +
  labs(x = "Market Value (Euros)", y = "Wage (Euros)", title = "Market Value vs Wage per League")

```
- The scatter plot visualizes the relationship between market value and wage for top football clubs across four major leagues.
- Data points are color-coded: black points represent typical data, and orange points indicate wage outliers beyond the upper bound ( as calculated as Q3 + 1.5 * IQR of wages).
- Outliers are visible across all leagues, more so in the English Premier League and less in the Spain Primera Division, suggesting variability in how wages are distributed relative to player market values.
- The plots demonstrate that while there is a general trend of higher wages associated with higher market values, there are exceptions, with some players receiving wages that are notably higher than the rest, given their market value.
- Each league shows a unique pattern of this relationship, but the English Premier League displays the most significant number of high-wage outliers, aligning with its higher correlation between wages and values.

```{r}
# Optional: create a bar plot to compare the correlation coefficients visually
ggplot(correlations, aes(x = league_name, y = correlation, fill = league_name)) +
  geom_col() +
  geom_text(aes(label = sprintf("%.2f", correlation)), vjust = -0.3) +
  labs(title = "Correlation between Market Value and Wage by League",
       x = "League", 
       y = "Pearson Correlation Coefficient") +
  theme_minimal() +
  theme(legend.position = "none", axis.text.x = element_text(angle = 45, hjust = 1))
```
- The English Premier League leads in wage-value correlation among top leagues, with Spain's Primera Division having the lowest.

### Bar Chart for Nationality
```{r}
# Calculate the count of players by nationality
nationality_counts <- fifa %>%
  count(nationality_name, sort = TRUE) %>%
  top_n(10) # Selects the top 10 rows by count

# Create the bar chart with only the top 10 nationalities
ggplot(nationality_counts, aes(x = reorder(nationality_name, n), y = n, fill = nationality_name)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Nationality", y = "Count", title = "Top 10 Nationalities in FIFA Dataset") +
  scale_fill_viridis_d(begin = 0.5, end = 0.9) + # Optional: a pleasant color scale from viridis
  theme(legend.position = "none") # Hide the legend as color does not add info in this context

```

### Bar Chart for Nationality in each 4 leagues: England, France, Italy, Spain
```{r}
# Calculate the count of players by nationality and league
nationality_counts <- fifa_top_clubs %>%
  count(league_name, nationality_name) %>%
  group_by(league_name) %>%
  top_n(10, wt = n) %>%
  ungroup() %>%
  arrange(league_name, desc(n))

# Create the bar chart for top 10 nationalities within each of the 4 leagues
ggplot(nationality_counts, aes(x = reorder(nationality_name, n), y = n, fill = nationality_name)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7)) +
  facet_wrap(~ league_name, scales = "free_x") +
  scale_fill_viridis_d() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Nationality", y = "Count", title = "Top 10 Nationalities in the Top 4 Leagues") +
  theme(legend.position = "none") # Hide legend, not informative in this context

```

### Segment Analysis: To check the relationship between international reputation and player contribution (e.g. overall rating)

```{r}
#scatter plot
ggplot(fifa, aes(x = overall, y = international_reputation)) +
  geom_point(aes(color = factor(league_name)), alpha = 0.6) +
  labs(x = "Overall Rating", y = "International Reputation", title = "Reputation vs Club Contribution by League") +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  geom_smooth(method = "lm", se = FALSE)

```
- 

*For better visualization - if we need*
```{r}
# Create a scatter plot with adjustments
ggplot(fifa, aes(x = overall, y = international_reputation, size = wage_eur)) +
  geom_point(aes(color = factor(league_name)), alpha = 0.6) + # Control point opacity with alpha
  labs(x = "Overall Rating", y = "International Reputation", title = "Reputation vs Club Contribution by League") +
  scale_color_brewer(palette = "Set1") +
  scale_size_continuous(range = c(1, 10), breaks = c(100000, 200000, 300000), labels = scales::comma) + # Adjust the size scale for wage
  geom_smooth(method = "lm", se = FALSE) +
  facet_wrap(~ league_name) + # Facet by league
  theme_minimal() +
  theme(legend.position = "right", # Adjust legend position
        legend.title = element_blank(), # Remove legend title for size
        plot.title = element_text(hjust = 0.5)) # Center the plot title

```
Interpretation:-

The graph displays the relationship between international reputation (y-axis) and overall rating (x-axis) for players across four football leagues, with each league represented by a different color.
Bubble size indicates the player's wage, with larger bubbles corresponding to higher wages.

Key Points to note here:

- In all leagues, players with a reputation of 1 tend to have a wide range of overall ratings, from the low 60s to the high 80s.
- A higher overall rating correlates with a better international reputation, especially noticeable in the Italian Serie A and Spanish Primera Division.
- The English Premier League showcases some players with the highest wages, evident from the larger red bubbles.
- The Italian Serie A has a significant number of players with a reputation score of 2, spread across a wide range of overall ratings.
- The Spanish Primera Division presents a notable concentration of players with large wage bubbles and a reputation score of 2, suggesting that players with moderate reputations in this league might command higher wages.
- Across all leagues, there are few players with the highest reputation score of 5; these players also tend to have high overall ratings and wages.
- The wage distribution appears consistent across reputation levels 2 and 3 in all leagues, with the majority of players earning mid-range wages.
- The distribution of reputation and wages seems quite compact in the French Ligue 1, suggesting less variability in player wages within reputation categories.

Conclusion: The graph indicates a general trend where players with higher overall ratings and international reputations also have higher wages, but there are exceptions, especially in the English Premier League and Spanish Primera Division, where wages can be high even for moderate reputations.

  ========================
# D. Clustering Techniques	
  ========================  
  
## a. Clustering Tendency Validation

Ho: Data is from a uniform distribution (no meaningful clusters). 
Ha: Data is not from a uniform distribution (with meaningful clusters). 

### i. Hopkins Statistic

```{r}
set.seed(123)
get_clust_tendency(fifa.num.scaled, n = nrow(fifa.num.scaled)-1, graph = FALSE)$hopkins_stat
```

```{r}
set.seed(123)
get_clust_tendency(fifa.num.inGK.scaled, n = nrow(fifa.num.inGK.scaled)-1, graph = FALSE)$hopkins_stat
```

```{r}
set.seed(123)
get_clust_tendency(fifa.num.exGK.scaled, n = nrow(fifa.num.exGK.scaled)-1, graph = FALSE)$hopkins_stat
```

The Hopkins statistic value for all three numerical datasets are far above the 0.5 threshold, an indication that the data sets are highly clusterable. Among the three, the dataset with goalkeepers but excluding the individual skills ratings has the highest Hopkins statistics (0.86).
The datasets with and without the goalkeepers will both be used for the clustering analyses. 


### ii. Visual Method

```{r}
fviz_dist(dist(fifa.num.scaled), show_labels = FALSE)
```

```{r}
fviz_dist(dist(fifa.num.inGK.scaled), show_labels = FALSE)
```

```{r}
fviz_dist(dist(fifa.num.exGK.scaled), show_labels = FALSE)
```  
The visual assessment of clustering tendency (VAT) algorithm detects the clustering tendency in visual form by referencing the blocks along the diagonal in the VAT image. The existence of clusters is indicated by the orange clusters along the diagonal and the size of each block represents the approximate size of the cluster.
- The first and second images suggests two clusters represented by the the two orange blocks along the diagonal for both the complete numerical dataset and the dataset including the goalkeepers but excluding the individual skill ratings.
- The third image suggests possible three clusters represented by the three orange blocks along the diagonal for the dataset excluding the goalkeepers.
- It can be noted that the visual representation is much clearer for the second image, which suggests that this dataset has the highest clustering tendency. 


##	b. Distances
```{r}
#including gk

# Compute distance matrices
euclidean_distance <- dist(fifa.num.inGK.scaled, method = "euclidean")
manhattan_distance <- dist(fifa.num.inGK.scaled, method = "manhattan")
canberra_distance <- dist(fifa.num.inGK.scaled, method = "canberra")
minkowski_distance <- dist(fifa.num.inGK.scaled, method = "minkowski")
cosine_similarity <- proxy::simil(fifa.num.inGK.scaled, method = "cosine")

# Convert distance matrices to vectors
euclidean_vector <- as.vector(euclidean_distance)
manhattan_vector <- as.vector(manhattan_distance)
canberra_vector <- as.vector(canberra_distance)
minkowski_vector <- as.vector(minkowski_distance)
cosine_vector <- as.vector(cosine_similarity)

# Initialize correlation matrix
correlation_matrix <- matrix(nrow = 5, ncol = 5)
rownames(correlation_matrix) <- colnames(correlation_matrix) <- c("Euclidean", "Manhattan", "Canberra", "Minkowski", "Cosine")

# Compute correlations between distance measures
correlation_matrix[1, 2] <- cor(euclidean_vector, manhattan_vector)
correlation_matrix[1, 3] <- cor(euclidean_vector, canberra_vector)
correlation_matrix[1, 4] <- cor(euclidean_vector, minkowski_vector)
correlation_matrix[1, 5] <- cor(euclidean_vector, cosine_vector)

correlation_matrix[2, 3] <- cor(manhattan_vector, canberra_vector)
correlation_matrix[2, 4] <- cor(manhattan_vector, minkowski_vector)
correlation_matrix[2, 5] <- cor(manhattan_vector, cosine_vector)

correlation_matrix[3, 4] <- cor(canberra_vector, minkowski_vector)
correlation_matrix[3, 5] <- cor(canberra_vector, cosine_vector)

correlation_matrix[4, 5] <- cor(minkowski_vector, cosine_vector)

# Fill the lower triangle and diagonal of the matrix
correlation_matrix[lower.tri(correlation_matrix)] <- t(correlation_matrix)[lower.tri(correlation_matrix)]
diag(correlation_matrix) <- 1

# Print the correlation matrix
correlation_matrix

```
The Euclidean, Manhattan, and Minkowski distance measures are highly correlated, indicating they provide similar information about the data. 

```{r}
#excluding gk
euclidean_dist <- dist(fifa.num.exGK.scaled, method = "euclidean")
manhattan_dist <- dist(fifa.num.exGK.scaled, method = "manhattan")
canberra_dist <- dist(fifa.num.exGK.scaled, method = "canberra")
minkowski_dist <- dist(fifa.num.exGK.scaled, method = "minkowski", p = 3)
cosine_similarity <- proxy::simil(fifa.num.exGK.scaled, method = "cosine")

euclidean_matrix <- as.matrix(euclidean_dist)
manhattan_matrix <- as.matrix(manhattan_dist)
canberra_matrix <- as.matrix(canberra_dist)
minkowski_matrix <- as.matrix(minkowski_dist)
cosine_matrix <- as.matrix(1 - cosine_similarity)  # cosine similarity to distance

# Flatten the upper triangle of the matrices
euclidean_vector <- euclidean_matrix[upper.tri(euclidean_matrix)]
manhattan_vector <- manhattan_matrix[upper.tri(manhattan_matrix)]
canberra_vector <- canberra_matrix[upper.tri(canberra_matrix)]
minkowski_vector <- minkowski_matrix[upper.tri(minkowski_matrix)]
cosine_vector <- cosine_matrix[upper.tri(cosine_matrix)]

# Calculate the correlations
correlation_matrix <- matrix(nrow = 5, ncol = 5)
rownames(correlation_matrix) <- colnames(correlation_matrix) <- c("Euclidean", "Manhattan", "Canberra", "Minkowski", "Cosine")

correlation_matrix[1, 2] <- cor(euclidean_vector, manhattan_vector)
correlation_matrix[1, 3] <- cor(euclidean_vector, canberra_vector)
correlation_matrix[1, 4] <- cor(euclidean_vector, minkowski_vector)
correlation_matrix[1, 5] <- cor(euclidean_vector, cosine_vector)

correlation_matrix[2, 3] <- cor(manhattan_vector, canberra_vector)
correlation_matrix[2, 4] <- cor(manhattan_vector, minkowski_vector)
correlation_matrix[2, 5] <- cor(manhattan_vector, cosine_vector)

correlation_matrix[3, 4] <- cor(canberra_vector, minkowski_vector)
correlation_matrix[3, 5] <- cor(canberra_vector, cosine_vector)

correlation_matrix[4, 5] <- cor(minkowski_vector, cosine_vector)

# Fill the lower triangle and diagonal of the matrix
correlation_matrix[lower.tri(correlation_matrix)] <- t(correlation_matrix)[lower.tri(correlation_matrix)]
diag(correlation_matrix) <- 1

# Print the correlation matrix
correlation_matrix

```


Comparing the observations for both datasets, including and excluding goalkeepers, along with various distance measures, we can derive the following insights:

- Euclidean and Manhattan distances exhibit strong positive correlations, indicating their consistent preference across player data.
- Canberra distance shows moderate correlations in both cases but is less strongly correlated with Euclidean and Manhattan distances.
- Minkowski distance demonstrates high correlations with Euclidean and Manhattan distances, reinforcing their preference.
- Cosine similarity shows lower correlation(excluding gk) and negative correlation (including gk) with other measures ;implying different behavior, likely due to its angle-based metric.

In summary, Euclidean and Manhattan distances remain the preferred choices for analyzing both datasets, inclusive and exclusive of goalkeepers, owing to their strong correlations and consistent behavior across the player data.

## c. Optimal Number of Clusters

### i. Elbow Method

```{r}
#Including goalkeepers
fviz_nbclust(fifa.num.inGK.scaled, kmeans, method = "wss") + labs(subtitle = "Elbow method - kmeans")
fviz_nbclust(fifa.num.inGK.scaled, pam, method = "wss") + labs(subtitle = "Elbow method - k-medoids")
fviz_nbclust(fifa.num.inGK.scaled, hcut, method = "wss") + labs(subtitle = "Elbow method - hierarchical")
```
Possible optimal number of clusters for the 3 methods using the dataset including goalkeepers: 2 to 6. 

```{r}
#Excluding goalkeepers
fviz_nbclust(fifa.num.exGK.scaled, kmeans, method = "wss") + labs(subtitle = "Elbow method - kmeans")
fviz_nbclust(fifa.num.exGK.scaled, pam, method = "wss") + labs(subtitle = "Elbow method - k-medoids")
fviz_nbclust(fifa.num.exGK.scaled, hcut, method = "wss") + labs(subtitle = "Elbow method - hierarchical")
```
Possible optimal number of clusters using the dataset excluding goalkeepers:
- k-means: 3
- k-medoids: 2 or 4
- hierarchical: 3

### ii. Silhouette Method

```{r}
#Including goalkeepers
fviz_nbclust(fifa.num.inGK.scaled, kmeans, method = "silhouette") + labs(subtitle = "Silhouette method - k-means")
fviz_nbclust(fifa.num.inGK.scaled, pam, method = "silhouette") + labs(subtitle = "Silhouette method - k-medoids")
fviz_nbclust(fifa.num.inGK.scaled, hcut, method = "silhouette") + labs(subtitle = "Silhouette method - hierarchical")
```
Possible optimal number of clusters for the 3 methods using the dataset including goalkeepers: 2. 

```{r}
#Excluding goalkeepers
fviz_nbclust(fifa.num.exGK.scaled, kmeans, method = "silhouette") + labs(subtitle = "Silhouette method - k-means")
fviz_nbclust(fifa.num.exGK.scaled, pam, method = "silhouette") + labs(subtitle = "Silhouette method - k-medoids")
fviz_nbclust(fifa.num.exGK.scaled, hcut, method = "silhouette") + labs(subtitle = "Silhouette method - hierarchical")
```
Possible optimal number of clusters using the dataset excluding goalkeepers:
- k-means: 3
- k-medoids and hierarchical: 2


### iii. Gap Statistic

```{r}
set.seed(123)
fviz_nbclust(fifa.num.inGK.scaled, kmeans, nstart = 25,  method = "gap_stat", nboot = 200) + labs(subtitle = "Gap statistic method - k-means")
#fviz_nbclust(fifa.num.inGK.scaled, pam, nstart = 25,  method = "gap_stat", nboot = 200) + labs(subtitle = "Gap statistic method - k-medoids")
#fviz_nbclust(fifa.num.inGK.scaled, hcut, nstart = 25,  method = "gap_stat", nboot = 200) + labs(subtitle = "Gap statistic method - hierarchical")
```

```{r}
set.seed(123)
fviz_nbclust(fifa.num.exGK.scaled, kmeans, nstart = 25,  method = "gap_stat", nboot = 200) + labs(subtitle = "Gap statistic method - k-means")
#fviz_nbclust(fifa.num.exGK.scaled, pam, nstart = 25,  method = "gap_stat", nboot = 200) + labs(subtitle = "Gap statistic method - k-medoids")
#fviz_nbclust(fifa.num.exGK.scaled, hcut, nstart = 25,  method = "gap_stat", nboot = 200) + labs(subtitle = "Gap statistic method - hierarchical")
```

### iv. Optimal number of clusters with NbClust (30 indices)
##### includeGK all numerical columns except individual skills
**Optimal number of clusters suggested by 30 indices for kmeans (inGK)**
```{r, echo = T, results = 'hide'}
# show the code but not the result
nb1 <- NbClust(fifa.num.inGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 10, method = "kmeans")
nb2 <- NbClust(fifa.num.inGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 10, method = "kmeans")
nb3 <- NbClust(fifa.num.inGK.scaled, distance = "canberra", min.nc = 2, max.nc = 10, method = "kmeans")
```
Majority of the time 3 clusters are suggested as the optimal number using all 3 distances, the closest second is 2 clusters.  

**Optimal number of clusters suggested by 30 indices for median clustering method (inGK)** (k-medoids)
```{r echo = T, results = 'hide'}
nb1 <- NbClust(fifa.num.inGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 6, method = "median")
nb2 <- NbClust(fifa.num.inGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 6, method = "median")
nb3 <- NbClust(fifa.num.inGK.scaled, distance = "canberra", min.nc = 2, max.nc = 6, method = "median")
```

Majority of the time 2 clusters are suggested as the optimal number, 5 clusters if using manhattan distance.  

**Optimal number of clusters suggested by 30 indices for ward.D2 clustering method (inGK)**
```{r echo = T, results = 'hide'}
nb1 <- NbClust(fifa.num.inGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 6, method = "ward.D2")
nb2 <- NbClust(fifa.num.inGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 6, method = "ward.D2")
nb3 <- NbClust(fifa.num.inGK.scaled, distance = "canberra", min.nc = 2, max.nc = 6, method = "ward.D2")
```

Majority of the time 2 clusters are suggested as the optimal number using all 3 distances.  

**Optimal number of clusters suggested by 30 indices for complete clustering method (inGK)**
```{r echo = T, results = 'hide'}
nb1 <- NbClust(fifa.num.inGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 6, method = "complete")
nb2 <- NbClust(fifa.num.inGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 6, method = "complete")
nb3 <- NbClust(fifa.num.inGK.scaled, distance = "canberra", min.nc = 2, max.nc = 6, method = "complete")
```

Majority of the time 2 clusters are suggested as the optimal number using all 3 distances.  

**Optimal number of clusters suggested by 30 indices for average clustering method (inGK)**
```{r echo = T, results = 'hide'}
nb1 <- NbClust(fifa.num.inGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 6, method = "average")
nb2 <- NbClust(fifa.num.inGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 6, method = "average")
nb3 <- NbClust(fifa.num.inGK.scaled, distance = "canberra", min.nc = 2, max.nc = 6, method = "average")
```

Majority of the time 2 clusters are suggested as the optimal number using all 3 distances.  

##### excludeGK all numerical columns
**Optimal number of clusters suggested by 30 indices for kmeans (exGK)**
```{r echo = T, results = 'hide'}
# show the code but not the result

nb1 <- NbClust(fifa.num.exGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 10, method = "kmeans")
nb2 <- NbClust(fifa.num.exGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 10, method = "kmeans")
nb3 <- NbClust(fifa.num.exGK.scaled, distance = "canberra", min.nc = 2, max.nc = 10, method = "kmeans")

```

Majority of the time 3 clusters are suggested as the optimal number using all 3 distances.  


**Optimal number of clusters suggested by 30 indices for median clustering method (exGK)**
```{r echo = T, results = 'hide'}
nb1 <- NbClust(fifa.num.exGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 6, method = "median")
nb2 <- NbClust(fifa.num.exGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 6, method = "median")
nb3 <- NbClust(fifa.num.exGK.scaled, distance = "canberra", min.nc = 2, max.nc = 6, method = "median")
```

Majority of the time 4 clusters are suggested as the optimal number, 2 clusters if using euclidean distance.  

**Optimal number of clusters suggested by 30 indices for ward.D2 clustering method (exGK)**
```{r echo = T, results = 'hide'}
nb1 <- NbClust(fifa.num.exGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 6, method = "ward.D2")
nb2 <- NbClust(fifa.num.exGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 6, method = "ward.D2")
nb3 <- NbClust(fifa.num.exGK.scaled, distance = "canberra", min.nc = 2, max.nc = 6, method = "ward.D2")
```

Majority of the time 3 clusters are suggested as the optimal number, 5 if using canberra distance.  

**Optimal number of clusters suggested by 30 indices for complete clustering method (exGK)**
```{r echo = T, results = 'hide'}
nb1 <- NbClust(fifa.num.exGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 6, method = "complete")
nb2 <- NbClust(fifa.num.exGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 6, method = "complete")
nb3 <- NbClust(fifa.num.exGK.scaled, distance = "canberra", min.nc = 2, max.nc = 6, method = "complete")
```

Majority of the time 2 or 3 clusters are suggested as the optimal number, 4 clusters if using manhattan distance.    

**Optimal number of clusters suggested by 30 indices for average clustering method (exGK)**
```{r echo = T, results = 'hide'}
nb1 <- NbClust(fifa.num.inGK.scaled, distance = "euclidean", min.nc = 2, max.nc = 6, method = "average")
nb2 <- NbClust(fifa.num.inGK.scaled, distance = "manhattan", min.nc = 2, max.nc = 6, method = "average")
nb3 <- NbClust(fifa.num.inGK.scaled, distance = "canberra", min.nc = 2, max.nc = 6, method = "average")
```

Majority of the time 2 clusters are suggested as the optimal number using all 3 distances.  


## d. Choosing the Best Clustering Algorithm

### i. Internal Measures

```{r}
#Including goalkeepers
clmethods <- c("kmeans", "pam", "hierarchical", "agnes", "diana", "fanny")

internal.inGK <- clValid(fifa.num.inGK.scaled, nClust = 2:6, 
              clMethods = clmethods, 
              validation = "internal", maxitems=880)
# Summary
summary(internal.inGK)
```

**Connectivity**  
- k=2 gives the lowest value for all methods

**Dunn**  
- k=2 gives the highest value for kmeans, pam, hierarchical
- k=2 and k=3 gives the highest for agnes and fanny
- k=3 gives the highest value for diana

**Silhouette width**  
- k=2 gives the value closest to 1 for all methods

Hierarchical clustering and agnes with two clusters performs the best in each case for connectivity, Dunn, and Silhouette measures. The three measures suggest two or three as the optimal number of clusters, depending on the algorithm.


```{r}
#Excluding goalkeepers
clmethods <- c("kmeans", "pam", "hierarchical", "agnes", "diana", "fanny")

internal.exGK <- clValid(fifa.num.exGK.scaled, nClust = 2:6, 
              clMethods = clmethods, 
              validation = "internal", maxitems=880)
# Summary
summary(internal.exGK)
```

**Connectivity**  
- k=2 gives the lowest value for all methods

**Dunn**  
- k=6 gives the highest value for kmeans, diana 
- k=5 and k=6 gives the highest value for pam
- k=2 gives the highest value for hierarchical, agnes
- k=3 gives the highest value for fanny

**Silhouette width**  
- k=3 gives the value closest to 1 for kmeans
- k=2 gives the values closest to 1 for the rest

Hierarchical clustering and agnes with two clusters performs the best in each case for connectivity, Dunn, and Silhouette measures. The three measures suggest 2, 3, or 6 as the optimal number of clusters, depending on the algorithm.


### ii. Stability Measures

```{r}
#Including goalkeepers
clmethods <- c("kmeans", "pam", "hierarchical", "agnes", "diana", "fanny")

stability.inGK <- clValid(fifa.num.inGK.scaled, nClust = 2:6, 
              clMethods = clmethods, 
              validation = "stability", maxitems=880)
# Summary
summary(stability.inGK)
```

For APN, hierarchical clustering with 2 clusters gives the best score. 
For AD and ADM, K-means with 6 and 2 clusters, respectively, give the best score.
For FOM, K-medoids with 6 clusters gives the best score.

```{r}
#Excluding goalkeepers
clmethods <- c("kmeans", "pam", "hierarchical", "agnes", "diana", "fanny")

stability.exGK <- clValid(fifa.num.exGK.scaled, nClust = 2:6, 
              clMethods = clmethods, 
              validation = "stability", maxitems=880)
# Summary
summary(stability.exGK)
```

For APN and ADM, hierarchical clustering with 2 clusters gives the best score. 
For AD, K-medoids with 6 clusters give the best score.
For FOM, K-means with 6 clusters gives the best score.

##	e. K-means 

### i. K-means using Euclidean distance and wss method

```{r}
# Perform elbow method to determine the optimal number of clusters
set.seed(123)
elbow <- fviz_nbclust(fifa.num.exGK, kmeans, method = "wss") + geom_vline(xintercept = 3, linetype = 2)

# Visualize the results
print(elbow)
```

From above the the elbow seems to appear around 3. Hence choosing 3 as number of clusters for k-means.

#### a. k-means with k=3

**Including the goalkeeper scaled dataset**
```{r}
#computing k-means using 3 as k value
set.seed(123)
km.res.inGK.wss <- kmeans(fifa.num.inGK.scaled, 3, nstart = 25)
print('K-means clustering with 3 clusters of sizes:')
print(km.res.inGK.wss$size)

print('Cluster means:')
print(km.res.inGK.wss$centers)
```

The k-means clustering with 3 clusters suggests distinct groupings based on player attributes, with cluster 1 showing relatively balanced skills, cluster 2 characterized by higher physical attributes and lower technical skills, and cluster 3 representing players with exceptional overall skills and high market value.

Here is the vizualisation for the clusters based on the k-means analysis.

```{r}
fviz_cluster(km.res.inGK.wss, 
             data = fifa.num.inGK.scaled,
             geom = "point",        # Use points to represent data
             palette = c("#2E9FDF", "#E7B800", "#FC4E07"), 
             ellipse = TRUE,       # Draw ellipses around clusters
             ellipse.type = "t",   # Use t-distribution for ellipses
             ellipse.level = 0.95, # Confidence level for ellipses
             star.plot = TRUE,     # Connect centroids to items
             repel = TRUE,         # Prevent label overlap
             ggtheme = theme_minimal()
)
```
The elliptical viz of the optimal number of clusters using K-means shows the above 3 clusters. The ellipse shows clear differences between the clusters with 47% in Dimension 1 & 26.1% in Dimension 2 with a total of 73.1% of the data represented.

**Excluding the goalkeeper scaled dataset**
```{r}
#computing k-means using 3 as k value
set.seed(123)
km.res.exGK.wss <- kmeans(fifa.num.exGK.scaled, 3, nstart = 25)
print('K-means clustering with 3 clusters of sizes:')
print(km.res.exGK.wss$size)

print('Cluster means:')
print(km.res.exGK.wss$centers)
```
The above k-means has a different mean when goalkeeper dataset is not considered. The clusters are divided based on balanced skills, physical skills and non-technical skills.

Here is the vizualisation for the clusters based on the k-means analysis.

```{r}
fviz_cluster(km.res.exGK.wss, 
             data = fifa.num.exGK.scaled,
             geom = "point",        # Use points to represent data
             palette = c("#2E9FDF", "#E7B800", "#FC4E07"), 
             ellipse = TRUE,       # Draw ellipses around clusters
             ellipse.type = "t",   # Use t-distribution for ellipses
             ellipse.level = 0.95, # Confidence level for ellipses
             star.plot = TRUE,     # Connect centroids to items
             repel = TRUE,         # Prevent label overlap
             ggtheme = theme_minimal()
)
```

The above plot shows the 3 clusters with 38.9% on dimension 1 and 23.8% on dimension 2 with the overall of 62.7% of the dataset is displayed.

#### b. k-means with k=2

Choosing another k value to be 2 as there seems to be a bend after that value.

**Including the goalkeeper scaled dataset**

```{r}
#computing k-means using 5 as k value
set.seed(123)
km.res.inGK.wss.1 <- kmeans(fifa.num.inGK.scaled, 2, nstart = 25)
print('K-means clustering with 2 clusters of sizes:')
print(km.res.inGK.wss.1$size)

print('Cluster means:')
print(km.res.inGK.wss.1$centers)

```
The clustering above indicates that the features are clubbed together while the demographics are in the second cluster with their means.

Plot
```{r}
fviz_cluster(km.res.inGK.wss.1, 
             data = fifa.num.inGK.scaled,
             geom = "point",        # Use points to represent data
             palette = c("skyblue", "#E7B800"), 
             ellipse = TRUE,       # Draw ellipses around clusters
             ellipse.type = "t",   # Use t-distribution for ellipses
             ellipse.level = 0.95, # Confidence level for ellipses
             star.plot = TRUE,     # Connect centroids to items
             repel = TRUE,         # Prevent label overlap
             ggtheme = theme_minimal()
)
```


**Excluding the goalkeeper scaled dataset**

```{r}
#computing k-means using 5 as k value
set.seed(123)
km.res.exGK.wss.1 <- kmeans(fifa.num.exGK.scaled, 2, nstart = 25)
print('K-means clustering with 2 clusters of sizes:')
print(km.res.exGK.wss.1$size)

print('Cluster means:')
print(km.res.exGK.wss.1$centers)

```

The clusters form are classified on the physical attributes and non-technical attribute with size of 428 and 372 for cluster 1 and cluster 2 respectively.

Plot
```{r}
fviz_cluster(km.res.exGK.wss.1, 
             data = fifa.num.exGK.scaled,
             geom = "point",        # Use points to represent data
             palette = c("skyblue", "#E7B800"), 
             ellipse = TRUE,       # Draw ellipses around clusters
             ellipse.type = "t",   # Use t-distribution for ellipses
             ellipse.level = 0.95, # Confidence level for ellipses
             star.plot = TRUE,     # Connect centroids to items
             repel = TRUE,         # Prevent label overlap
             ggtheme = theme_minimal()
)
```

With k=2 the euclidean k-means seems to explain the data in more compact and its better to understand. 

### ii. K-means using manhattan distance

#### a. k-means using k=3

**Including goalkeeper dataset**
```{r}
# Calculate Manhattan distance matrix
dist_matrix_manhattan_1 <- dist(fifa.num.inGK.scaled, method = "manhattan")

# Perform k-means clustering using preprocessed data
km.inGK.manhattan.1 <- kmeans(dist_matrix_manhattan_1, centers = 3)

print('K-means using manhattan clustering with 3 clusters of sizes:')
print(km.inGK.manhattan.1$size)

print('Cluster means:')
print(km.inGK.manhattan.1$centers[,3])
```
The means indicates that the cluster 3 is wide spreaded from center with a size of 538 points in the cluster.
Here is the vizualisation for the same.

```{r}

fviz_cluster(km.inGK.manhattan.1, 
             data = fifa.num.inGK.scaled,
             geom = "point",        # Use points to represent data
             palette = c("#2E9FDF", "#E7B800", "#FC4E07"), 
             ellipse = TRUE,       # Draw ellipses around clusters
             ellipse.type = "t",   # Use t-distribution for ellipses
             ellipse.level = 0.95, # Confidence level for ellipses
             star.plot = TRUE,     # Connect centroids to items
             repel = TRUE,         # Prevent label overlap
             ggtheme = theme_minimal()
)
```

**Excluding goalkeeper dataset**
```{r}
# Calculate Manhattan distance matrix
dist_matrix_manhattan <- dist(fifa.num.exGK.scaled, method = "manhattan")

# Perform k-means clustering using preprocessed data
km.exGK.manhattan <- kmeans(dist_matrix_manhattan, centers = 3)

print('K-means using manhattan clustering with 3 clusters of sizes:')
print(km.exGK.manhattan$size)

print('Cluster means:')
print(km.exGK.manhattan$centers[,3])
```

The above k-means is performed using manhattan distance matrix and has 3 clusters similar to the wss method used before. Here is the vizualisation for the same.

```{r}

fviz_cluster(km.exGK.manhattan, 
             data = fifa.num.exGK.scaled,
             geom = "point",        # Use points to represent data
             palette = c("#2E9FDF", "#E7B800", "#FC4E07"), 
             ellipse = TRUE,       # Draw ellipses around clusters
             ellipse.type = "t",   # Use t-distribution for ellipses
             ellipse.level = 0.95, # Confidence level for ellipses
             star.plot = TRUE,     # Connect centroids to items
             repel = TRUE,         # Prevent label overlap
             ggtheme = theme_minimal()
)
```
The above k-means is performed using manhattan distance formula to calculate the ideal number of clusters and the plot shows the distribution based on 3 clusters. The cluster is not evenly divided as with k-means algorithm.

#### b. k-means using k=2

**Including goalkeeper dataset**
```{r}
# Perform k-means clustering using preprocessed data
km.inGK.manhattan.2 <- kmeans(dist_matrix_manhattan_1, centers = 2)

print('K-means using manhattan clustering with 3 clusters of sizes:')
print(km.inGK.manhattan.2$size)

print('Cluster means:')
print(km.inGK.manhattan.2$centers[,3])
```

Plot
```{r}

fviz_cluster(km.inGK.manhattan.2, 
             data = fifa.num.inGK.scaled,
             geom = "point",        # Use points to represent data
             palette = c("#2E9FDF", "#E7B800"), 
             ellipse = TRUE,       # Draw ellipses around clusters
             ellipse.type = "t",   # Use t-distribution for ellipses
             ellipse.level = 0.95, # Confidence level for ellipses
             star.plot = TRUE,     # Connect centroids to items
             repel = TRUE,         # Prevent label overlap
             ggtheme = theme_minimal()
)
```

The cluster 2 is densely populated with 756 data points indicating a overall attributes being closed to cluster 2.

**Excluding goalkeeper dataset**
```{r}
# Perform k-means clustering using preprocessed data
km.exGK.manhattan.1 <- kmeans(dist_matrix_manhattan, centers = 2)

print('K-means using manhattan clustering with 3 clusters of sizes:')
print(km.exGK.manhattan.1$size)

print('Cluster means:')
print(km.exGK.manhattan.1$centers[,3])
```

The above variation is worse for k=2 when manhattan distance is considered and the size for cluster 1 is 607 and cluster 2 is 193 indicating the physical attributes being considered dominantly than the non-technical attributes overall.

Plot
```{r}

fviz_cluster(km.exGK.manhattan.1, 
             data = fifa.num.exGK.scaled,
             geom = "point",        # Use points to represent data
             palette = c("#2E9FDF", "#E7B800"), 
             ellipse = TRUE,       # Draw ellipses around clusters
             ellipse.type = "t",   # Use t-distribution for ellipses
             ellipse.level = 0.95, # Confidence level for ellipses
             star.plot = TRUE,     # Connect centroids to items
             repel = TRUE,         # Prevent label overlap
             ggtheme = theme_minimal()
)
```

For manhattan distance for k=2 the variability is reduced to more clearer and compact format. The sizes of 706 and 94 was detected with k-means function.

As it can be seen that the distortion in k-means using Manhattan distance metric is less than that of k-means using Euclidean distance metric for the 3 clusters identified by the elbow method. Hence, we will choose k-means using euclidean distance rather than manhattan distance.

### iii. Aggregating data back to original dataset to compare for K=3 k-means using euclidean distance method. (Overall)

**Excluding goalkeeper dataset**
```{r}
km.res.exGK.wss$centers
table(km.res.exGK.wss$centers)

aggregate(fifa.num.exGK, by = list(kmeans.cluster = km.res.exGK.wss$cluster), mean) ##compute mean with the original data
aggregate(fifa.num.exGK, by = list(kmeans.cluster = km.res.exGK.wss$cluster), median)##can apply to other summary #statistics.
aggregate(fifa.num.exGK, by = list(kmeans.cluster = km.res.exGK.wss$cluster), sd)##can apply to other summary statistics.
table(fifa.exGK$attack_position, km.res.exGK.wss$cluster)
```
-From the 3 clusters result, we identify 3 groups of players. After computing the mean of each variable for each cluster, we notice that the overall rating(83.6), potential (85), wage (118K), value (49million) of cluster 3 are really higher than the 2 other clusters.  

-Additionally comparing cluster 1 and 2, we can see that the overall rating is similar but the potential is higher than the overall (77-78). Age mean in cluster 1 & 2 is similar of 27 and is the a bit low of 26 in Cluster 1.  

-We tend to interpret that cluster 3 represents the group of top players with an international career, cluster 1 represents players in the beginning of their career with still some potential, and the cluster 2 represents the players at the end of their career who are older with limited potential.


**Including goalkeeper dataset**
```{r}
km.res.inGK.wss$centers
table(km.res.inGK.wss$centers)

aggregate(fifa.num.inGK, by = list(kmeans.cluster.inGK = km.res.inGK.wss$cluster), mean) ##compute mean with the original data
aggregate(fifa.num.inGK, by = list(kmeans.cluster.inGK = km.res.inGK.wss$cluster), median)##can apply to other summary #statistics.
aggregate(fifa.num.inGK, by = list(kmeans.cluster.inGK = km.res.inGK.wss$cluster), sd)##can apply to other summary statistics.
table(fifa.num.inGK$overall, km.res.inGK.wss$cluster)
```

-From the 3 clusters result, we identify 3 groups of players. After computing the mean of each variable for each cluster, we notice that the overall rating(84.9), potential (86.85), wage (140K), value (58million) of cluster 2 are really higher than the 2 other clusters.  

-Additionally comparing cluster 1 and 3, we can see that the overall rating is similar but the potential is higher than the overall (78-79). Age is highest for group 1 whereas lowest for cluster 3 indicating cluster includes younger population whereas cluster 1 has players who are older with limited potential.

##	f. K-medoids / Clara  
  
### i. Compute k-medoids on numerical variables  

#### Compute k-medoids on numerical variables except individual skills, i.e. including GoalKeepers.
Estimate the number of clusters with silhouette method  
```{r}
fviz_nbclust(fifa.num.inGK.scaled, pam, method = "silhouette")  # method pam for k-medoids
```

The silhouette plot suggests 2   

1. Compute k-medoids clustering with 2,3,4,5,6 clusters  
```{r}
set.seed(1234)
kmd2.inGK.res <- pam(fifa.num.inGK.scaled, 2) # 2 clusters
kmd3.inGK.res <- pam(fifa.num.inGK.scaled, 3) # 3 clusters
kmd4.inGK.res <- pam(fifa.num.inGK.scaled, 4) # 4 clusters
kmd5.inGK.res <- pam(fifa.num.inGK.scaled, 5) # 5 clusters
kmd6.inGK.res <- pam(fifa.num.inGK.scaled, 6) # 6 clusters

```

Cluster size for 2,3,4,5,6 clusters 
```{r}
kmd2.inGK.res$medoids
table(kmd2.inGK.res$clustering)
kmd3.inGK.res$medoids
table(kmd3.inGK.res$clustering)
kmd4.inGK.res$medoids
table(kmd4.inGK.res$clustering)
kmd5.inGK.res$medoids
table(kmd5.inGK.res$clustering)
kmd6.inGK.res$medoids
table(kmd6.inGK.res$clustering)

```

visualization for 2,3,4,5,6 clusters  
```{r}
fviz_cluster(kmd2.inGK.res, data = fifa.num.inGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 2 clusters on fifa including GK") 
fviz_cluster(kmd3.inGK.res, data = fifa.num.inGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 3 clusters on fifa including GK") 
fviz_cluster(kmd4.inGK.res, data = fifa.num.inGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 4 clusters on fifa including GK") 
fviz_cluster(kmd5.inGK.res, data = fifa.num.inGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 5 clusters on fifa including GK") 
fviz_cluster(kmd6.inGK.res, data = fifa.num.inGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 6 clusters on fifa including GK") 

```
With 2 and 3 clusters the clusters are relatively well esparated.
With 4 and up clusters, some clusters are overlapping significantly, so this is not a good clustering.  

2. Obtain the mean for each variable in each cluster of 3 clusters   
```{r}
kmd3.inGK.res$medoids
table(kmd3.inGK.res$clustering)

aggregate(fifa.num.inGK, by = list(cluster = kmd3.inGK.res$cluster), mean) ##compute mean with the original data
aggregate(fifa.num.inGK, by = list(cluster = kmd3.inGK.res$cluster), median)##can apply to other summary statistics.
aggregate(fifa.num.inGK, by = list(cluster = kmd3.inGK.res$cluster), sd)##can apply to other summary statistics.
```
From the 3 clusters result, we identify 3 groups of players. After computing the mean of each variable for each cluster, we notice that the overall rating(82.8), potential (85), wage (100K), value (43million) of cluster 1 are really higher than the 2 other clusters.  
Additionally comparing cluster 2 and 3, we can see that the overall rating is similar but the potential is higher than the overall (74-78), and similar in clusters 3 (75-76). Age mean in cluster 2 is the lowest (25) and the highest in cluster 3 (28).  
We tend to interpret that cluster 1 represents the group of top players with an international career, cluster 2 represents younger players in the beginning of their career with still some potential, and the cluster 3 represents the players at the end of their career who are older with limited potential.



If you want to add the point classifications to the original data, use this:  
```{r}
dd <- cbind(fifa, cluster = kmd3.inGK.res$cluster)
colnames(fifa)
head(dd)
```

**See the different variables values per cluster**
```{r}
table(dd$league_name,dd$cluster)
table(dd$attack_position,dd$cluster)
table(dd$body_type,dd$cluster)
table(dd$simple_body_type,dd$cluster)
table(dd$age_group,dd$cluster)
table(dd$height_group,dd$cluster)
table(dd$weight_group,dd$cluster)
table(dd$wage_group,dd$cluster)
table(dd$international_reputation,dd$cluster)
table(dd$international_reputation_factor,dd$cluster)
```


Use pamk  
```{r}
kmd <- pamk(fifa.num.inGK.scaled,krange=2:6,criterion="asw",critout=TRUE)
#kmd
kmd$nc #nb clusters suggested
kmd$pamobject$medoids # medoids
table(kmd$pamobject$clustering) # size of clusters
```

visualization for 2 clusters  
```{r}
fviz_cluster(kmd$pamobject, data = fifa.num.inGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 2 clusters on fifa including GK") 

```
Same result as using kmeans for 2 clusters.  

#### Compute k-medoids on numerical variables including individual skills, i.e. excluding GoalKeepers.
Estimate the number of clusters with silhouette method  
```{r}
fviz_nbclust(fifa.num.exGK.scaled, pam, method = "silhouette")  # method pam for k-medoids
```

The silhouette plot suggests 2   

Compute k-medoids clustering with 2,3,4,5,6 clusters  
```{r}
set.seed(1234)
kmd2.exGK.res <- pam(fifa.num.exGK.scaled, 2) # 2 clusters
kmd3.exGK.res <- pam(fifa.num.exGK.scaled, 3) # 3 clusters
kmd4.exGK.res <- pam(fifa.num.exGK.scaled, 4) # 4 clusters
kmd5.exGK.res <- pam(fifa.num.exGK.scaled, 5) # 5 clusters
kmd6.exGK.res <- pam(fifa.num.exGK.scaled, 6) # 6 clusters

```

Cluster size for 2,3,4,5,6 clusters 
```{r}
kmd2.exGK.res$medoids
table(kmd2.exGK.res$clustering)
kmd3.exGK.res$medoids
table(kmd3.exGK.res$clustering)
kmd4.exGK.res$medoids
table(kmd4.exGK.res$clustering)
kmd5.exGK.res$medoids
table(kmd5.exGK.res$clustering)
kmd6.exGK.res$medoids
table(kmd6.exGK.res$clustering)

```

visualization for 2,3,4,5,6 clusters  
```{r}
fviz_cluster(kmd2.exGK.res, data = fifa.num.exGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 2 clusters on fifa excluding GK") 
fviz_cluster(kmd3.exGK.res, data = fifa.num.exGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 3 clusters on fifa excluding GK") 
fviz_cluster(kmd4.exGK.res, data = fifa.num.exGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 4 clusters on fifa excluding GK") 
fviz_cluster(kmd5.exGK.res, data = fifa.num.exGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 5 clusters on fifa excluding GK") 
fviz_cluster(kmd6.exGK.res, data = fifa.num.exGK.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 6 clusters on fifa excluding GK") 

```
2 clusters are best esparated.  


```{r}
kmd3.exGK.res$medoids
table(kmd3.exGK.res$clustering)

aggregate(fifa.num.exGK, by = list(cluster = kmd3.exGK.res$cluster), mean) ##compute mean with the original data
aggregate(fifa.num.exGK, by = list(cluster = kmd3.exGK.res$cluster), median)##can apply to other summary statistics.
aggregate(fifa.num.exGK, by = list(cluster = kmd3.exGK.res$cluster), sd)##can apply to other summary statistics.
table(fifa.exGK$attack_position, kmd3.exGK.res$cluster)
```


### ii. Compute k-medoids only on ratings  
Extract numerical ratings variables only, that exclude the GoalKeepers
```{r}
columns_num_ratings <- c("overall", "potential", "pace", "shooting", "passing", "dribbling", "defending", "physic")
fifa.ratings <- fifa[columns_num_ratings]
head(fifa.ratings)
str(fifa.ratings)
summary(fifa.ratings)
```

Remove the missing values before applying k-medoids  
We don't need to scale as all rating variables are of the same scale.  
```{r}
fifa.ratings <- na.omit(fifa.ratings)
summary(fifa.ratings)
```

Estimate the number of clusters with silhouette method  
```{r}
fviz_nbclust(fifa.ratings, pam, method = "silhouette") +  # method pam for k-medoids
    geom_vline(xintercept = 5, linetype = 2) # print the line on 5 

```

Suggested number of clusters is 2  

Compute k-medoids clustering with 2,3,4,5 clusters  
```{r}
set.seed(1234)
kmd2r.res <- pam(fifa.ratings, 2) # 2 clusters
kmd3r.res <- pam(fifa.ratings, 3) # 3 clusters
kmd4r.res <- pam(fifa.ratings, 4) # 4 clusters
kmd5r.res <- pam(fifa.ratings, 5) # 5 clusters
```

Cluster size  
```{r}
kmd2r.res$medoids
table(kmd2r.res$clustering)
kmd3r.res$medoids
table(kmd3r.res$clustering)
kmd4r.res$medoids
table(kmd4r.res$clustering)
kmd5r.res$medoids
table(kmd5r.res$clustering)

```

visualization for 2,3,4,5 clusters  
```{r}
fviz_cluster(kmd2r.res, data = fifa.ratings,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 2 clusters on fifa using only ratings variables") 
fviz_cluster(kmd3r.res, data = fifa.ratings,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 3 clusters on fifa using only ratings variables") 
fviz_cluster(kmd4r.res, data = fifa.ratings,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 4 clusters on fifa using only ratings variables") 
fviz_cluster(kmd5r.res, data = fifa.ratings,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 5 clusters on fifa using only ratings variables") 
```

There are a lot of overlapping of clusters when the number increases, even with 2 clusters.  




### iii. Compute k-medoids on physical and money variables, that includes GoalKeepers 
Extract numerical ratings variables only  
```{r}
columns_num_phys <- c("value_eur", "wage_eur", "age", "height_cm", "weight_kg")
fifa.phys <- fifa[columns_num_phys]
head(fifa.phys)
str(fifa.phys)
summary(fifa.phys)
```

There is no missing values.   
Standardize the data before applying k-medoids because value, wage, age, height and weight are of different scale.  
```{r}
fifa.phys.scaled <- scale(fifa.phys)
summary(fifa.phys.scaled)
```

Estimate the number of clusters with silhouette method  
```{r}
fviz_nbclust(fifa.phys.scaled, pam, method = "silhouette") +  # method pam for k-medoids
    geom_vline(xintercept = 5, linetype = 2) # print the line on 5 

```
Silhouette method suggests 3 clusters  

Compute k-medoids clustering with 3,4,5 clusters  
```{r}
set.seed(1234)
kmd3p.res <- pam(fifa.phys.scaled, 3) # 3 clusters
kmd4p.res <- pam(fifa.phys.scaled, 4) # 4 clusters
kmd5p.res <- pam(fifa.phys.scaled, 5) # 5 clusters
```

Cluster size  
```{r}
kmd3p.res$medoids
table(kmd3p.res$clustering)
kmd4p.res$medoids
table(kmd4p.res$clustering)
kmd5p.res$medoids
table(kmd5p.res$clustering)
```

visualization for 3,4,5 clusters  
```{r}
fviz_cluster(kmd3p.res, data = fifa.phys.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 3 clusters on fifa using only physical and money variables") 
fviz_cluster(kmd4p.res, data = fifa.phys.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 4 clusters on fifa using only physical and money variables") 
fviz_cluster(kmd5p.res, data = fifa.phys.scaled,
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             ggtheme = theme_minimal()) + 
             ggtitle(label="k-medoids 5 clusters on fifa using only physical and money variables") 

```

The 3 clusters are nicely separated with several points on the edge of clusters 2 and 3. 
With more than 3 clusters, there is significant overlapping between clusters.  



##	g. Hierarchical Clustering

### i. Dissimilarity matrix 

Convert character columns to factor
```{r}
col <- c("club_name", "league_name", "club_position", "attack_position", "nationality_name", "preferred_foot", "body_type")
fifa.inGK[col] <- lapply(fifa.inGK[col], as.factor)
fifa.exGK[col] <- lapply(fifa.exGK[col], as.factor)
```

Dataset including goalkeepers (highest Hopkins statistic):
```{r}
fifa.inGK.dist.man <- dist(fifa.num.inGK.scaled, method = "manhattan")
fifa.inGK.dist.euc <- dist(fifa.num.inGK.scaled, method = "euclidean")
fifa.inGK.dist.daisy <- daisy(fifa.inGK)
```

Dataset excluding goalkeepers:
```{r}
fifa.exGK.dist.man <- dist(fifa.num.exGK.scaled, method = "manhattan")
fifa.exGK.dist.euc <- dist(fifa.num.exGK.scaled, method = "euclidean")
fifa.exGK.dist.daisy <- daisy(fifa.exGK)
```

### ii. Hierarchical Clustering (hclust)

**Including goalkeepers**

Manhattan:
```{r}
man.hc.ave.inGK <- hclust(d = fifa.inGK.dist.man, method = "average")
man.hc.comp.inGK <- hclust(d = fifa.inGK.dist.man, method = "complete")
man.hc.ward.inGK <- hclust(d = fifa.inGK.dist.man, method = "ward.D2")
man.hc.min.inGK <- hclust(d = fifa.inGK.dist.man, method = "single")
man.hc.cent.inGK <- hclust(d = fifa.inGK.dist.man, method = "centroid")
```

Euclidean:
```{r}
euc.hc.ave.inGK <- hclust(d = fifa.inGK.dist.euc, method = "average")
euc.hc.comp.inGK <- hclust(d = fifa.inGK.dist.euc, method = "complete")
euc.hc.ward.inGK <- hclust(d = fifa.inGK.dist.euc, method = "ward.D2")
euc.hc.min.inGK <- hclust(d = fifa.inGK.dist.euc, method = "single")
euc.hc.cent.inGK <- hclust(d = fifa.inGK.dist.euc, method = "centroid")
```

Daisy:
```{r}
daisy.hc.ave.inGK <- hclust(d = fifa.inGK.dist.daisy, method = "average")
daisy.hc.comp.inGK <- hclust(d = fifa.inGK.dist.daisy, method = "complete")
daisy.hc.ward.inGK <- hclust(d = fifa.inGK.dist.daisy, method = "ward.D2")
daisy.hc.min.inGK <- hclust(d = fifa.inGK.dist.daisy, method = "single")
daisy.hc.cent.inGK <- hclust(d = fifa.inGK.dist.daisy, method = "centroid")
```


**Excluding goalkeepers**

Manhattan:

```{r}
man.hc.ave.exGK <- hclust(d = fifa.exGK.dist.man, method = "average")
man.hc.comp.exGK <- hclust(d = fifa.exGK.dist.man, method = "complete")
man.hc.ward.exGK <- hclust(d = fifa.exGK.dist.man, method = "ward.D2")
man.hc.min.exGK <- hclust(d = fifa.exGK.dist.man, method = "single")
man.hc.cent.exGK <- hclust(d = fifa.exGK.dist.man, method = "centroid")
```

Euclidean:
```{r}
euc.hc.ave.exGK <- hclust(d = fifa.exGK.dist.euc, method = "average")
euc.hc.comp.exGK <- hclust(d = fifa.exGK.dist.euc, method = "complete")
euc.hc.ward.exGK <- hclust(d = fifa.exGK.dist.euc, method = "ward.D2")
euc.hc.min.exGK <- hclust(d = fifa.exGK.dist.euc, method = "single")
euc.hc.cent.exGK <- hclust(d = fifa.exGK.dist.euc, method = "centroid")
```

Daisy:
```{r}
daisy.hc.ave.exGK <- hclust(d = fifa.exGK.dist.daisy, method = "average")
daisy.hc.comp.exGK <- hclust(d = fifa.exGK.dist.daisy, method = "complete")
daisy.hc.ward.exGK <- hclust(d = fifa.exGK.dist.daisy, method = "ward.D2")
daisy.hc.min.exGK <- hclust(d = fifa.exGK.dist.daisy, method = "single")
daisy.hc.cent.exGK <- hclust(d = fifa.exGK.dist.daisy, method = "centroid")
```

#### Correlation

**Including goalkeepers**

Manhattan:
```{r}
cor(fifa.inGK.dist.man, cophenetic(man.hc.ave.inGK))
cor(fifa.inGK.dist.man, cophenetic(man.hc.comp.inGK))
cor(fifa.inGK.dist.man, cophenetic(man.hc.ward.inGK))
cor(fifa.inGK.dist.man, cophenetic(man.hc.min.inGK))
cor(fifa.inGK.dist.man, cophenetic(man.hc.cent.inGK))
```
Euclidean:
```{r}
cor(fifa.inGK.dist.euc, cophenetic(euc.hc.ave.inGK))
cor(fifa.inGK.dist.euc, cophenetic(euc.hc.comp.inGK))
cor(fifa.inGK.dist.euc, cophenetic(euc.hc.ward.inGK))
cor(fifa.inGK.dist.euc, cophenetic(euc.hc.min.inGK))
cor(fifa.inGK.dist.euc, cophenetic(euc.hc.cent.inGK))
```

Daisy:
```{r}
cor(fifa.inGK.dist.daisy, cophenetic(daisy.hc.ave.inGK))
cor(fifa.inGK.dist.daisy, cophenetic(daisy.hc.comp.inGK))
cor(fifa.inGK.dist.daisy, cophenetic(daisy.hc.ward.inGK))
cor(fifa.inGK.dist.daisy, cophenetic(daisy.hc.min.inGK))
cor(fifa.inGK.dist.daisy, cophenetic(daisy.hc.cent.inGK))
```

Compare correlation between cophenetic distance and the original distance matrix:
- strong correlation means clustering is valid
- values above 0.75 are good (the closer the correlation value to 1, the more accurately the clustering reflects the data)

Dissimilarity matrix using Euclidean distance and average linkage has the highest correlation (0.746).


**Excluding goalkeepers**

Manhattan:
```{r}
cor(fifa.exGK.dist.man, cophenetic(man.hc.ave.exGK))
cor(fifa.exGK.dist.man, cophenetic(man.hc.comp.exGK))
cor(fifa.exGK.dist.man, cophenetic(man.hc.ward.exGK))
cor(fifa.exGK.dist.man, cophenetic(man.hc.min.exGK))
cor(fifa.exGK.dist.man, cophenetic(man.hc.cent.exGK))
```
Euclidean:
```{r}
cor(fifa.exGK.dist.euc, cophenetic(euc.hc.ave.exGK))
cor(fifa.exGK.dist.euc, cophenetic(euc.hc.comp.exGK))
cor(fifa.exGK.dist.euc, cophenetic(euc.hc.ward.exGK))
cor(fifa.exGK.dist.euc, cophenetic(euc.hc.min.exGK))
cor(fifa.exGK.dist.euc, cophenetic(euc.hc.cent.exGK))
```

Daisy:
```{r}
cor(fifa.exGK.dist.daisy, cophenetic(daisy.hc.ave.exGK))
cor(fifa.exGK.dist.daisy, cophenetic(daisy.hc.comp.exGK))
cor(fifa.exGK.dist.daisy, cophenetic(daisy.hc.ward.exGK))
cor(fifa.exGK.dist.daisy, cophenetic(daisy.hc.min.exGK))
cor(fifa.exGK.dist.daisy, cophenetic(daisy.hc.cent.exGK))
```

Dissimilarity matrix using Euclidean distance and average linkage has the highest correlation (0.67) but the correlation value being below 0.75 means that the clustering may not accurately reflect the data structure.


#### Dendrograms

**Including goalkeepers**
```{r}
dend.euc.ave2 <- fviz_dend(euc.hc.ave.inGK, cex = 0.5, k = 2, k_colors = 'jco', ggtheme = theme_gray())
#dend.euc.ave2
```


```{r}
dend.euc.ave3 <- fviz_dend(euc.hc.ave.inGK, cex = 0.5, k = 3, k_colors = 'jco', ggtheme = theme_gray())
#dend.euc.ave3
```


```{r}
dend.euc.ave5 <- fviz_dend(euc.hc.ave.inGK, cex = 0.5, k = 5, k_colors = 'jco', ggtheme = theme_gray())
#dend.euc.ave5
```


#### Cluster members

**Including goalkeepers**

Cut tree into groups:
```{r}
grp2.inGK <- cutree(euc.hc.ave.inGK, k = 2)
grp3.inGK <- cutree(euc.hc.ave.inGK, k = 3)
grp5.inGK <- cutree(euc.hc.ave.inGK, k = 5)
```

Show members of smaller clusters:

k=2:
```{r}
rownames(fifa.num.inGK)[grp2.inGK == 1]
```
k=3:
```{r}
rownames(fifa.num.inGK)[grp3.inGK == 1]
rownames(fifa.num.inGK)[grp3.inGK == 2]
```
k=5:
```{r}
rownames(fifa.num.inGK)[grp5.inGK == 1]
rownames(fifa.num.inGK)[grp5.inGK == 2]
rownames(fifa.num.inGK)[grp5.inGK == 3]
rownames(fifa.num.inGK)[grp5.inGK == 5]
```

Using k=2 for hierarchical clustering for dataset including goalkeepers (Euclidean distance with average linkage) makes most sense given that some clusters when using k=3 and k=5 give 1 or 2 cluster members only. 

**Excluding goalkeepers**

Cut tree into groups:
```{r}
grp2.exGK <- cutree(euc.hc.ave.exGK, k = 2)
grp3.exGK <- cutree(euc.hc.ave.exGK, k = 3)
grp5.exGK <- cutree(euc.hc.ave.exGK, k = 5)
```

Show members of smaller clusters:

k=2:
```{r}
rownames(fifa.num.exGK)[grp2.exGK == 2]
length(rownames(fifa.num.exGK)[grp2.exGK == 1])
```

k=3:
```{r}
rownames(fifa.num.exGK)[grp3.exGK == 2]
rownames(fifa.num.exGK)[grp3.exGK == 3]
length(rownames(fifa.num.exGK)[grp3.exGK == 1])
```

k=5:
```{r}
rownames(fifa.num.exGK)[grp5.exGK == 2]
rownames(fifa.num.exGK)[grp5.exGK == 3]
rownames(fifa.num.exGK)[grp5.exGK == 4]
rownames(fifa.num.exGK)[grp5.exGK == 5]
length(rownames(fifa.num.exGK)[grp5.exGK == 1])
```

Hierarchical clustering for dataset excluding goalkeepers (Euclidean distance with average linkage) did not give good clustering results since most clusters give 1 or 2 cluster members only. 


### iii. AGNES Hierarchical Clustering

**Including goalkeepers**
```{r}
agnes.euc.ave.inGK <- agnes(x = fifa.num.inGK.scaled, stand = TRUE, metric = "euclidean", method = "average")
agnes.euc.min.inGK <- agnes(x = fifa.num.inGK.scaled, stand = TRUE, metric = "euclidean", method = "single")
agnes.euc.comp.inGK <- agnes(x = fifa.num.inGK.scaled, stand = TRUE, metric = "euclidean", method = "complete")
agnes.euc.ward.inGK <- agnes(x = fifa.num.inGK.scaled, stand = TRUE, metric = "euclidean", method = "ward")
```

**Excluding goalkeepers**
```{r}
agnes.euc.ave.exGK <- agnes(x = fifa.num.exGK.scaled, stand = TRUE, metric = "euclidean", method = "average")
agnes.euc.min.exGK <- agnes(x = fifa.num.exGK.scaled, stand = TRUE, metric = "euclidean", method = "single")
agnes.euc.comp.exGK <- agnes(x = fifa.num.exGK.scaled, stand = TRUE, metric = "euclidean", method = "complete")
agnes.euc.ward.exGK <- agnes(x = fifa.num.exGK.scaled, stand = TRUE, metric = "euclidean", method = "ward")
```

#### Correlation

**Including goalkeepers**
```{r}
cor(fifa.inGK.dist.euc, cophenetic(agnes.euc.ave.inGK))
cor(fifa.inGK.dist.euc, cophenetic(agnes.euc.min.inGK))
cor(fifa.inGK.dist.euc, cophenetic(agnes.euc.comp.inGK))
cor(fifa.inGK.dist.euc, cophenetic(agnes.euc.ward.inGK))
```
Dissimilarity matrix using Euclidean distance and average linkage has the highest correlation (0.73).

**Excluding goalkeepers**
```{r}
cor(fifa.exGK.dist.euc, cophenetic(agnes.euc.ave.exGK))
cor(fifa.exGK.dist.euc, cophenetic(agnes.euc.min.exGK))
cor(fifa.exGK.dist.euc, cophenetic(agnes.euc.comp.exGK))
cor(fifa.exGK.dist.euc, cophenetic(agnes.euc.ward.exGK))
```
Dissimilarity matrix using Euclidean distance and average linkage has the highest correlation (0.67), but may not reflect true structure of the dataset. 

#### Dendrogram

**Including goalkeepers**
```{r}
fviz_dend(agnes.euc.ave.inGK, k_colors='jco', color_labels_by_k = TRUE,
          cex = 0.4, k=3)
```

**Excluding goalkeepers**
```{r}
fviz_dend(agnes.euc.ave.exGK, k_colors='jco', color_labels_by_k = TRUE,
          cex = 0.4, k=3)
```

#### Cluster members

**Including goalkeepers**

Cut tree into groups:
```{r}
grp2.agnes.inGK <- cutree(agnes.euc.ave.inGK, k = 2)
grp3.agnes.inGK <- cutree(agnes.euc.ave.inGK, k = 3)
grp5.agnes.inGK <- cutree(agnes.euc.ave.inGK, k = 5)
```

Show members of smaller clusters:

k=2:
```{r}
rownames(fifa.num.inGK)[grp2.agnes.inGK == 1]
```
k=3:
```{r}
rownames(fifa.num.inGK)[grp3.agnes.inGK == 1]
rownames(fifa.num.inGK)[grp3.agnes.inGK == 2]
```
k=5:
```{r}
rownames(fifa.num.inGK)[grp5.agnes.inGK == 1]
rownames(fifa.num.inGK)[grp5.agnes.inGK == 2]
rownames(fifa.num.inGK)[grp5.agnes.inGK == 3]
rownames(fifa.num.inGK)[grp5.agnes.inGK == 4]
```

Using k=2 for hierarchical clustering for dataset including goalkeepers (Euclidean distance with average linkage) makes most sense given that some clusters when using k=3 and k=5 give 1 or 2 cluster members only. 

**Excluding goalkeepers**

Cut tree into groups:
```{r}
grp2.agnes.exGK <- cutree(agnes.euc.ave.exGK, k = 2)
grp3.agnes.exGK <- cutree(agnes.euc.ave.exGK, k = 3)
grp5.agnes.exGK <- cutree(agnes.euc.ave.exGK, k = 5)
```

Show members of smaller clusters:

k=2:
```{r}
rownames(fifa.num.exGK)[grp2.agnes.exGK == 1]
```
k=3:
```{r}
rownames(fifa.num.exGK)[grp3.agnes.exGK == 1]
rownames(fifa.num.exGK)[grp3.agnes.exGK == 3]
```
k=5:
```{r}
rownames(fifa.num.exGK)[grp5.agnes.exGK == 1]
rownames(fifa.num.exGK)[grp5.agnes.exGK == 2]
rownames(fifa.num.exGK)[grp5.agnes.exGK == 3]
rownames(fifa.num.exGK)[grp5.agnes.exGK == 5]
```
Using k=2 for hierarchical clustering for dataset excluding goalkeepers (Euclidean distance with average linkage) makes most sense given that some clusters when using k=3 and k=5 give 1 or 2 cluster members only. 

### iv. DIANA Hierarchical Clustering

**Including goalkeepers**
```{r}
diana.euc.inGK <- diana(x = fifa.num.inGK.scaled, stand = TRUE, metric = "euclidean")
diana.man.inGK <- diana(x = fifa.num.inGK.scaled, stand = TRUE, metric = "manhattan")
```

**Excluding goalkeepers**
```{r}
diana.euc.exGK <- diana(x = fifa.num.exGK.scaled, stand = TRUE, metric = "euclidean")
diana.man.exGK <- diana(x = fifa.num.exGK.scaled, stand = TRUE, metric = "manhattan")
```

#### Correlation

**Including goalkeepers**
```{r}
cor(fifa.inGK.dist.euc, cophenetic(diana.euc.inGK))
cor(fifa.inGK.dist.man, cophenetic(diana.man.inGK))
```

**Excluding goalkeepers**
```{r}
cor(fifa.exGK.dist.euc, cophenetic(diana.euc.exGK))
cor(fifa.exGK.dist.man, cophenetic(diana.man.exGK))
```

Almost the same correlation for Euclidean and Manhattan distance. 


#### Dendogram

**Including goalkeepers**
```{r}
fviz_dend(diana.euc.inGK, k_colors='jco', color_labels_by_k = TRUE,
          cex = 0.4, k=3)
```

**Including goalkeepers**
```{r}
fviz_dend(diana.euc.exGK, k_colors='jco', color_labels_by_k = TRUE,
          cex = 0.4, k=3)
```

#### Cluster members

**Including goalkeepers**

Cut tree into groups:
```{r}
grp2.diana.inGK <- cutree(diana.euc.inGK, k = 2)
grp3.diana.inGK <- cutree(diana.euc.inGK, k = 3)
```

Show members of smaller clusters:

k=2:
```{r}
rownames(fifa.num.inGK)[grp2.diana.inGK == 1]
```

k=3:
```{r}
rownames(fifa.num.inGK)[grp3.diana.inGK == 1]
rownames(fifa.num.inGK)[grp3.diana.inGK == 2]
```

**Excluding goalkeepers**

Cut tree into groups:
```{r}
grp2.diana.exGK <- cutree(diana.euc.exGK, k = 2)
grp3.diana.exGK <- cutree(diana.euc.exGK, k = 3)
```

Show members of smaller clusters:

k=2:
```{r}
rownames(fifa.num.exGK)[grp2.diana.exGK == 1]
```
  
  
k=3:
```{r}
rownames(fifa.num.exGK)[grp3.diana.exGK == 1]
rownames(fifa.num.exGK)[grp3.diana.exGK == 2]
```


### v. Comparison of Dendrograms

**Including goalkeepers**
```{r}
dend.hc.inGK <- as.dendrogram (euc.hc.ave.inGK)
dend.agnes.inGK <- as.dendrogram (agnes.euc.ave.inGK)
dend.diana.inGK <- as.dendrogram (diana.euc.inGK)
```

```{r}
dend.list.inGK <- dendlist("hclust" = dend.hc.inGK,
                       "agnes" = dend.agnes.inGK,
                       "diana" = dend.diana.inGK)
```

**Excluding goalkeepers**
```{r}
dend.hc.exGK <- as.dendrogram (euc.hc.ave.exGK)
dend.agnes.exGK <- as.dendrogram (agnes.euc.ave.exGK)
dend.diana.exGK <- as.dendrogram (diana.euc.exGK)
```

```{r}
dend.list.exGK <- dendlist("hclust" = dend.hc.exGK,
                       "agnes" = dend.agnes.exGK,
                       "diana" = dend.diana.exGK)
```

#### Correlation matrix

**Including goalkeepers**

Cophenetic:
```{r}
cor.coph.inGK <- cor.dendlist(dend.list.inGK, method = "cophenetic")
round(cor.coph.inGK, 2)
```
Hierarchical clusters from hclust and agnes methods are highly correlated.

**Excluding goalkeepers**

Cophenetic:
```{r}
cor.coph.exGK <- cor.dendlist(dend.list.exGK, method = "cophenetic")
round(cor.coph.exGK, 2)
```
Hierarchical clusters from hclust, agnes, and diana methods are moderately correlated.

### vi. Cluster Distribution

```{r}
hc.grp <- cutree(euc.hc.ave.inGK, k = 2)
agnes.grp <- cutree(diana.euc.inGK, k = 2)
diana.grp <- cutree(diana.euc.inGK, k = 2)
```

```{r}
#Add clusters to original df
#fifa.clusters <- cbind(fifa, cluster = hc.grp)
```


#### Cluster Means

Cluster 1
- higher mean overall, potential
- significantly higher mean value_eur and wage_eur
- similar age, height, weight

Hierarchical:
```{r}
aggregate(fifa.num.inGK, by = list(cluster = hc.grp), mean)
```

Agnes:
```{r}
aggregate(fifa.num.inGK, by = list(cluster = agnes.grp), mean)
```

Diana:
```{r}
aggregate(fifa.num.inGK, by = list(cluster = diana.grp), mean)
```

#### Cluster Standard Deviation

Cluster 1 
- more spread out value_eur, wage_eur, height, weight

Cluster 2
- more spread out overall, potential, age

Hierarchical:
```{r}
aggregate(fifa.num.inGK, by = list(cluster = hc.grp), sd)
```

#### Cluster Size

```{r}
table(hc.grp)
```


#### Distribution based on Attack Position

Cluster 1
- composed mainly of Attack (33%) and Midfield positions (31%)

Cluster 2
- composed mainly of Defense (37%) and Midfield positions (37%)

```{r}
table.attack <- table(hc.grp, fifa.inGK$attack_position)
table.attack
```

#### Distribution based on League

Cluster 1
- mostly English Premier League (49%) and Spain Primera Division (31%)

Cluster 2
- almost evenly distributed from 4 leagues

```{r}
table.league <- table(hc.grp, fifa.inGK$league_name)
table.league
```

#### Distribution based on Nationality

Cluster 1
- mostly from Brazil (6), France (6), Spain (6)

Cluster 2
- mostly from Spain (150), France (131), England (78), Italy (78), Brazil (39), Argentina (29)

```{r}
table.nat <- table(hc.grp, fifa.inGK$nationality_name)
table.nat
```

#### Distribution based on Preferred foot

Cluster 1 and 2
- mostly right foot

```{r}
table.foot <- table(hc.grp, fifa.inGK$preferred_foot)
table.foot
```

#### Distribution based on Body type

Cluster 1
- mostly unique

Cluster 2
- mostly Lean (170-185), Normal (170-185), Normal (185+)

```{r}
table.body <- table(hc.grp, fifa.inGK$body_type)
table.body
```

#### Distribution based on International reputation

Cluster 1
- mostly 3 and 4

Cluster 2
- mostly 1 and 2

```{r}
table.rep <- table(hc.grp, fifa.inGK$international_reputation)
table.rep
```
### vii. Using eclust function

#### Hierarchical Clustering

**Including goalkeepers**

Using k=2:

**hclust**
```{r}
euc.ave.hclust.inGK2 <- eclust(fifa.num.inGK.scaled, k=2, "hclust", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrogram
#fviz_dend(euc.ave.hclust.inGK2, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

**agnes**
```{r}
euc.ave.agnes.inGK2 <- eclust(fifa.num.inGK.scaled, k=2, "agnes", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrogram
#fviz_dend(euc.ave.agnes.inGK2, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

**diana**
```{r}
euc.ave.diana.inGK2 <- eclust(fifa.num.inGK.scaled, k=2, "diana", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrograms
#fviz_dend(euc.ave.diana.inGK2, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

Using k=3:

**hclust**
```{r}
euc.ave.hclust.inGK3 <- eclust(fifa.num.inGK.scaled, k=3, "hclust", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrogram
#fviz_dend(euc.ave.hclust.inGK3, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

**agnes**
```{r}
euc.ave.agnes.inGK3 <- eclust(fifa.num.inGK.scaled, k=3, "agnes", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrogram
#fviz_dend(euc.ave.agnes.inGK3, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

**diana**
```{r}
euc.ave.diana.inGK3 <- eclust(fifa.num.inGK.scaled, k=3, "diana", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrograms
#fviz_dend(euc.ave.diana.inGK3, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```


**Excluding goalkeepers**

Using k=2:

**hclust**
```{r}
euc.ave.hclust.exGK2 <- eclust(fifa.num.exGK.scaled, k=2, "hclust", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrogram
#fviz_dend(euc.ave.hclust.exGK2, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

**agnes**
```{r}
euc.ave.agnes.exGK2 <- eclust(fifa.num.exGK.scaled, k=2, "agnes", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrogram
#fviz_dend(euc.ave.agnes.exGK2, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

**diana**
```{r}
euc.ave.diana.exGK2 <- eclust(fifa.num.exGK.scaled, k=2, "diana", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrograms
#fviz_dend(euc.ave.diana.exGK2, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

Using k=3:

**hclust**
```{r}
euc.ave.hclust.exGK3 <- eclust(fifa.num.exGK.scaled, k=3, "hclust", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrogram
#fviz_dend(euc.ave.hclust.exGK3, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

**agnes**
```{r}
euc.ave.agnes.exGK3 <- eclust(fifa.num.exGK.scaled, k=3, "agnes", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrogram
#fviz_dend(euc.ave.agnes.inGK3, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```

**diana**
```{r}
euc.ave.diana.exGK3 <- eclust(fifa.num.exGK.scaled, k=3, "diana", hc_metric = "euclidean", hc_method = "average", graph = FALSE)

# Visualize dendrograms
#fviz_dend(euc.ave.diana.exGK3, show_labels = TRUE, palette = "jco", as.ggplot = TRUE)
```


#### Clustering Validation

##### Internal Measures

###### Silhouette Coefficient

**Including goalkeepers**

```{r}
sc.info.hclust2.inGK <- euc.ave.hclust.inGK2$silinfo
sc.info.agnes2.inGK <- euc.ave.agnes.inGK2$silinfo
sc.info.diana2.inGK <- euc.ave.diana.inGK2$silinfo
sc.info.hclust3.inGK <- euc.ave.hclust.inGK3$silinfo
sc.info.agnes3.inGK <- euc.ave.agnes.inGK3$silinfo
sc.info.diana3.inGK <- euc.ave.diana.inGK3$silinfo
```

Average silhouette width of each cluster:
```{r}
sc.info.hclust2.inGK$clus.avg.widths
sc.info.agnes2.inGK$clus.avg.widths
sc.info.diana2.inGK$clus.avg.widths
sc.info.hclust3.inGK$clus.avg.widths
sc.info.agnes3.inGK$clus.avg.widths
sc.info.diana3.inGK$clus.avg.widths
```

Total average silhouette width:
```{r}
sc.info.hclust2.inGK$avg.width
sc.info.agnes2.inGK$avg.width
sc.info.diana2.inGK$avg.width
sc.info.hclust3.inGK$avg.width
sc.info.agnes3.inGK$avg.width
sc.info.diana3.inGK$avg.width
```

Clustering using hclust and agnes have the same total average silhoutte width and average silhouette width per cluster, which are both higher (and closer to 1) compared to the silhouette widths for diana. These indicate that the clusters formed by hclust and agnes have better clustering structure, where within-cluster distances are minimized and between-cluster distances are maximized. 

Average silhouette width is higher and closer to 1 for k=2 vs k=3 for both hclust and agnes. 

**Excluding goalkeepers**

```{r}
sc.info.hclust2.exGK <- euc.ave.hclust.exGK2$silinfo
sc.info.agnes2.exGK <- euc.ave.agnes.exGK2$silinfo
sc.info.diana2.exGK <- euc.ave.diana.exGK2$silinfo
sc.info.hclust3.exGK <- euc.ave.hclust.exGK3$silinfo
sc.info.agnes3.exGK <- euc.ave.agnes.exGK3$silinfo
sc.info.diana3.exGK <- euc.ave.diana.exGK3$silinfo
```

Average silhouette width of each cluster:
```{r}
sc.info.hclust2.exGK$clus.avg.widths
sc.info.agnes2.exGK$clus.avg.widths
sc.info.diana2.exGK$clus.avg.widths
sc.info.hclust3.exGK$clus.avg.widths
sc.info.agnes3.exGK$clus.avg.widths
sc.info.diana3.exGK$clus.avg.widths
```

Total average silhouette width:
```{r}
sc.info.hclust2.exGK$avg.width
sc.info.agnes2.exGK$avg.width
sc.info.diana2.exGK$avg.width
sc.info.hclust3.exGK$avg.width
sc.info.agnes3.exGK$avg.width
sc.info.diana3.exGK$avg.width
```

Clustering using hclust and agnes have the same total average silhoutte width and average silhouette width per cluster, which are both higher (and closer to 1) compared to the silhouette widths for diana. These indicate that the clusters formed by hclust and agnes have better clustering structure, where within-cluster distances are minimized and between-cluster distances are maximized. 

Average silhouette width is higher and closer to 1 for k=2 vs k=3 for both hclust and agnes. 

The dataset excluding goalkeepers has the higher average silhouette widths compared to the dataset including goalkeepers, which indicate better clustering results.


###### Dunn's Index

**Including goalkeepers**

```{r}
# Statistics for clustering
hclust_stats2.inGK <- cluster.stats(dist(fifa.num.inGK.scaled),  euc.ave.hclust.inGK2$cluster)
agnes_stats2.inGK <- cluster.stats(dist(fifa.num.inGK.scaled),  euc.ave.agnes.inGK2$cluster)
diana_stats2.inGK <- cluster.stats(dist(fifa.num.inGK.scaled),  euc.ave.diana.inGK2$cluster)
hclust_stats3.inGK <- cluster.stats(dist(fifa.num.inGK.scaled),  euc.ave.hclust.inGK3$cluster)
agnes_stats3.inGK <- cluster.stats(dist(fifa.num.inGK.scaled),  euc.ave.agnes.inGK3$cluster)
diana_stats3.inGK <- cluster.stats(dist(fifa.num.inGK.scaled),  euc.ave.diana.inGK3$cluster)
```

```{r}
# Dunn's index
hclust_stats2.inGK$dunn
agnes_stats2.inGK$dunn
diana_stats2.inGK$dunn
hclust_stats3.inGK$dunn
agnes_stats3.inGK$dunn
diana_stats3.inGK$dunn
```
Clustering using hclust and agnes have the same Dunn's index (0.125), which are both higher compared to the Dunn's index for diana. This indicates that the clusters formed by hclust and agnes have better clustering structure. 

The same Dunn's index for k=2 and k=3.


**Excluding goalkeepers**

```{r}
# Statistics for clustering
hclust_stats2.exGK <- cluster.stats(dist(fifa.num.exGK.scaled),  euc.ave.hclust.exGK2$cluster)
agnes_stats2.exGK <- cluster.stats(dist(fifa.num.exGK.scaled),  euc.ave.agnes.exGK2$cluster)
diana_stats2.exGK <- cluster.stats(dist(fifa.num.exGK.scaled),  euc.ave.diana.exGK2$cluster)
hclust_stats3.exGK <- cluster.stats(dist(fifa.num.exGK.scaled),  euc.ave.hclust.exGK3$cluster)
agnes_stats3.exGK <- cluster.stats(dist(fifa.num.exGK.scaled),  euc.ave.agnes.exGK3$cluster)
diana_stats3.exGK <- cluster.stats(dist(fifa.num.exGK.scaled),  euc.ave.diana.exGK3$cluster)
```

```{r}
# Dunn's index
hclust_stats2.exGK$dunn
agnes_stats2.exGK$dunn
diana_stats2.exGK$dunn
hclust_stats3.exGK$dunn
agnes_stats3.exGK$dunn
diana_stats3.exGK$dunn
```
Clustering using hclust and agnes have the same Dunn's index (0.28, 0.17), which are both higher compared to the Dunn's index for diana. Also, Dunn's index is higher for k=2 (0.28) vs k=3 (0.17). These indicate that the clusters formed by hclust and agnes using k=2 have better clustering structure. 

The dataset excluding goalkeepers has the higher Dunn's compared to the dataset including goalkeepers, which indicate better clustering results.

###### Conclusion

Both silhouette width and Dunn's index suggest that hclust and agnes clustering using the dataset excluding goalkeepers and k=2 result in better clustering structure. 


##	other techniques
### Fuzzy clustering

Fuzzy is based on probabilities so it may give a different result  

**Fuzzy on including GK with 5 clusters**
```{r}
res.fanny5 <- fanny(fifa.inGK, 5)  # Compute fuzzy clustering with k = 5
res.fanny5$coeff # Dunn's partition coefficient
fviz_silhouette(res.fanny5, palette = "jco",
                ggtheme = theme_minimal())
fviz_cluster(res.fanny5, 
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             legend = "right", 
             ggtheme = theme_minimal()) + 
             ggtitle(label="Fuzzy 5 clusters on fifa including GK") 
```
Dunn coefficient is 0.53, average (close to 1 is good) 
Average silhouette show different width but  similar height except cluster 5 higher than other 

Check the distribution of international_position in the 5 clusters
```{r}
table(fifa.inGK$international_reputation,res.fanny5$clustering)
#table(fifa.inGK$attack_position,res.fanny5$clustering)

```
It's not very clear that each cluster represents the international reputation, there is some overlapping or indecision especially in cluster 2 and 3. However the extremes are more clear, cluster 1 and 2 contain most of the players with high international reputation (4,5), and Cluster 4 and 5 contain most of the players with low international reputation.

**Fuzzy on excluding GK with 3 clusters**
```{r}
res.fanny3 <- fanny(fifa.exGK, 3)  # Compute fuzzy clustering with k = 3
res.fanny3$coeff # Dunn's partition coefficient
fviz_silhouette(res.fanny3, palette = "jco",
                ggtheme = theme_minimal())
fviz_cluster(res.fanny3, 
             palette = "Set1", 
             ellipse.type = "convex", # Concentration ellipse
             show.clust.cent = TRUE, 
             geom = "point", #print only points, no labels 
             legend = "right", 
             ggtheme = theme_minimal()) + 
             ggtitle(label="Fuzzy 3 clusters on fifa including GK") 
```

Dunn coefficient is 0.65, relatively good (close to 1 is good)  

Check the distribution of international_position, attack_position in the 3 clusters
```{r}
table(fifa.exGK$international_reputation_factor,res.fanny3$clustering)
table(fifa.exGK$attack_position,res.fanny3$clustering)

```
It's not very clear that each cluster represents the simplified international reputation (low, average,excellent), there is some overlapping or indecision especially for Average. However the extremes are more clear, cluster 1 contains most of the players with excellent international reputation (4,5), and Cluster 3 contains most of the players with low international reputation.

Nothing obvious showing relation with the 3 clusters and attack_position.  



  ===================  
# E. Classification	
  ===================  
##	FA

```{r}
# Calculate the correlation matrix
cor_matrix <- cor(fifa.num.exGK.scaled)

# Eigenvalues and eigenvectors
eigen_info <- eigen(cor_matrix)

# Eigenvalues
eigenvalues <- eigen_info$values

# Eigenvectors
eigenvectors <- eigen_info$vectors

# Display eigenvalues
print(eigenvalues)
```
eigenvalues > 1: first four factors are significant 
```{r}
# Preliminary tests
fa.parallel(fifa.num.exGK.scaled, fa = "fa", fm = "minres")
cortest.bartlett(fifa.num.exGK.scaled)
KMO(fifa.num.exGK.scaled)
```
- The Bartlett’s Test of Sphericity being significant (p-value < 0.05) indicates that your correlation matrix is significantly different from the identity matrix, which means that the variables are related and suitable for structure detection using factor analysis.
- Kaiser-Meyer-Olkin (KMO) measure of 0.73 indicates a moderate level of adequacy for factor analysis.
- Measure of Sampling Adequacy (MSA) is high for 'wage_eur', indicating its suitability for factor analysis.
- Scree plot; factors = 3 or 4

Choosing 3 factors:
```{r}
# Factor Analysis with Principal Axis Factoring
extraction_method <- "minres" 
n_factors <- 3 #from parallel analysis 
rotation_method <- "varimax" 
```

```{r}
# Execute Factor Analysis
fa_result <- fa(fifa.num.exGK.scaled, nfactors = n_factors, rotate = rotation_method, fm = extraction_method)

# Print the factor loadings with cutoff for simplicity
print(fa_result$loadings, cutoff = 0.3)
```
- MR1 is strongly associated with overall ability, potential, market value, and wage, indicating it might represent a 'Player Quality and Value' factor.
- MR2 is mainly related to physical attributes like height and weight, suggesting it's a 'Physicality' factor.
- MR3 is strongly linked to age, which could represent a 'Player Maturity' factor.
- The first factor (MR1) explains the most variance (32.7%), followed by MR2 (25%), and MR3 (9.5%), with cumulative variance explained by the three factors being 67.1%.


Choosing 4 factors:
```{r}
# Factor Analysis with Principal Axis Factoring
extraction_method <- "minres" 
n_factors <- 4 #from parallel analysis 
rotation_method <- "varimax" 
```

```{r}
# Execute Factor Analysis
fa_result <- fa(fifa.num.exGK.scaled, nfactors = n_factors, rotate = rotation_method, fm = extraction_method)

# Print the factor loadings with cutoff for simplicity
print(fa_result$loadings, cutoff = 0.3)
```
- MR1 correlates highly with overall rating, potential, market value, and wages, representing a factor likely tied to 'Player Status & Economic Value.'
- MR2 is associated with physical attributes (height and weight), indicating a 'Physical Attributes' factor.
- MR3, related to age, suggests a 'Player Experience' factor.
- MR4 has strong loadings on shooting and defending, hinting at a 'Skill Proficiency' factor.
- Together, these factors cumulatively explain 75.1% of the variance in the data, with MR1 contributing the most (31.9%) and MR3 the least (9.4%).

```{r}
n_factors <- 4
extraction_method <- "minres" 
rotation_method <- "varimax"

# Perform Factor Analysis
fa_result <- fa(r = fifa.num.exGK.scaled, nfactors = n_factors, fm = extraction_method, rotate = rotation_method)

# Check the results of the factor analysis
print(fa_result)

#factor scores:
scores <- factor.scores(fifa.num.exGK.scaled, fa_result)

# Check the scores
print(scores)

#combine the scores with original data, cbind
fifa_with_scores <- cbind(fifa.num.exGK.scaled, scores$scores)

# Check the combined data
head(fifa_with_scores)

```
```{r}
fa.diagram(fa_result)

```
From the plot we can see:
- **MR1** is linked with players’ market aspects, such as performance, potential, and financial value.
- **MR2** is associated with physical traits like height and weight, indicating a physicality factor.
- **MR3** has a significant relationship with age and defending, suggesting it reflects player experience and defensive skills.
- **MR4** shows an inverse relationship between physical strength and speed, hinting at a factor differentiating between power and agility.

Conclusion: The conclusion we can draw is that the factor analysis has successfully distilled the variables into meaningful components that can explain different facets of a football player's attributes, potentially useful for scouting, team building, or gaming purposes.



## Stepwise
### Choose wage as predicting variable, including GoalKeepers

**Predict wage of players including Goal Keepers**
Stepwise model including Goal keepers to predict the player's salary
```{r}
fifa.step.inGK <- fifa.inGK
#colnames(fifa.step)
# remove the name of the player, and international_reputation_factor, attack_position which is not an original column 
fifa.step.inGK <- fifa.inGK[, !names(fifa.inGK) %in% c('international_reputation_factor','attack_position')]
# convert international_reputation into a factor
fifa.step.inGK$international_reputation <- as.factor(fifa.step.inGK$international_reputation)
#dim(fifa.step)
#head(fifa.step)
#colnames(fifa.step)

#define intercept-only model
intercept_only.inGK <- lm(wage_eur ~ 1, data=fifa.step.inGK)

#define model with all predictors
all.inGK <- lm(wage_eur ~ ., data=fifa.step.inGK)

#perform forward stepwise regression
# start with the smallest model, factors are added one by one in the forward method
forward.inGK <- step(intercept_only.inGK, direction='forward', scope=formula(all), trace=0)

#view results of forward stepwise regression
forward.inGK$anova

#perform both stepwise regression
# start with the smallest model, factors are added one by one in the forward method
both1.inGK <- step(intercept_only.inGK, direction='both', scope=formula(all), trace=0)

#view results of forward stepwise regression
both1.inGK$anova

#perform backward stepwise regression
backward.inGK <- step(all.inGK, direction='backward', scope=formula(all), trace=0)

#view results of forward stepwise regression
backward.inGK$anova
```

Forward and both directions elimination are giving the same list of variables:  
  club_name, international_reputation, value_eur, age, club_position, overall, body_type, potential.
Backward elimination gives the list of variables to eliminate from the model:
  league_name, nationality_name, preferred_foot, weight_kg, height_cm
Both methods agree and give the same significant variables to predict the wage.  

Eliminate the highly correlated variables: potential, passing, dribbling, height
```{r}
fifa.step.inGK <- fifa.inGK
#colnames(fifa.step)
# remove the name of the player, and international_reputation_factor, attack_position which is not an original column 
fifa.step.inGK <- fifa.inGK[, !names(fifa.inGK) %in% c('international_reputation_factor','attack_position','potential', 'passing',  'dribbling','height_cm')]
# convert international_reputation into a factor
fifa.step.inGK$international_reputation <- as.factor(fifa.step.inGK$international_reputation)
#dim(fifa.step)
#head(fifa.step)
#colnames(fifa.step)

#define intercept-only model
intercept_only.inGK <- lm(wage_eur ~ 1, data=fifa.step.inGK)

#define model with all predictors
all.inGK <- lm(wage_eur ~ ., data=fifa.step.inGK)

#perform forward stepwise regression
# start with the smallest model, factors are added one by one in the forward method
forward.inGK <- step(intercept_only.inGK, direction='forward', scope=formula(all.inGK), trace=0)

#view results of forward stepwise regression
forward.inGK$anova

#perform both stepwise regression
both1.inGK <- step(intercept_only.inGK, direction='both', scope=formula(all.inGK), trace=0)

#view results of forward stepwise regression
both1.inGK$anova

#perform backward stepwise regression
backward.inGK <- step(all.inGK, direction='backward', scope=formula(all.inGK), trace=0)

#view results of forward stepwise regression
backward.inGK$anova
```

Forward and both directions elimination are giving the same list of variables:    
  club_name, international_reputation, value_eur, age, club_position, overall, body_type.  
Backward elimination gives the list of variables to eliminate from the model:
  league_name, nationality_name, weight_kg, preferred_foot. 
Both methods agree and give the same significant variables to predict the wage.  
  
The list is the same as previously for each forward and backward directions minus the variables that we removed due to multicollinearity.

Using the variables selected with the forward method makes sense. 


### Choose wage as predicting variable, excluding GoalKeepers

**Predict international reputation for players excluding Goal Keepers** 
```{r}
fifa.step.exGK <- fifa.exGK
#colnames(fifa.step)
# remove the name of the player, and international_reputation_factor, attack_position which is not an original column 
fifa.step.exGK <- fifa.exGK[, !names(fifa.exGK) %in% c('international_reputation_factor','attack_position')]
# convert international_reputation into a factor
fifa.step.exGK$international_reputation <- as.factor(fifa.step.exGK$international_reputation)
#dim(fifa.step)
#head(fifa.step)
#colnames(fifa.step)

#define intercept-only model
intercept_only.exGK <- lm(wage_eur ~ 1, data=fifa.step.exGK)

#define model with all predictors
all.exGK <- lm(wage_eur ~ ., data=fifa.step.exGK)

#perform forward stepwise regression
# start with the smallest model, factors are added one by one in the forward method
forward.exGK <- step(intercept_only.exGK, direction='forward', scope=formula(all.exGK), trace=0)

#view results of forward stepwise regression
forward.exGK$anova

#perform both stepwise regression
# start with the smallest model, factors are added one by one in the forward method
both1.exGK <- step(intercept_only.exGK, direction='both', scope=formula(all.exGK), trace=0)

#view results of forward stepwise regression
both1.exGK$anova

#perform backward stepwise regression
backward.exGK <- step(all.exGK, direction='backward', scope=formula(all.exGK), trace=0)

#view results of forward stepwise regression
backward.exGK$anova
```

Forward and both directions elimination are giving the same list of variables:  
  club_name, international_reputation, value_eur, age, overall, body_type, potential, shooting.
Backward elimination gives the list of variables to eliminate from the model:
  league_name, nationality_name, club_position, defending, preferred_foot, dribbling, pace, physic, weight_kg. 
Only the variable "passing" is not considered in any direction.
Globally both methods agree and give the same significant variables to predict the wage.  
 

Eliminate the highly correlated variables: potential, passing, dribbling, height
```{r}
fifa.step.exGK <- fifa.exGK
#colnames(fifa.step)
# remove the name of the player, and international_reputation_factor, attack_position which is not an original column 
fifa.step.exGK <- fifa.exGK[, !names(fifa.exGK) %in% c('international_reputation_factor','attack_position','potential', 'passing',  'dribbling','height_cm')]
# convert international_reputation into a factor
fifa.step.exGK$international_reputation <- as.factor(fifa.step.exGK$international_reputation)
#dim(fifa.step)
#head(fifa.step)
#colnames(fifa.step)

#define intercept-only model
intercept_only.exGK <- lm(wage_eur ~ 1, data=fifa.step.exGK)

#define model with all predictors
all.exGK <- lm(wage_eur ~ ., data=fifa.step.exGK)

#perform forward stepwise regression
# start with the smallest model, factors are added one by one in the forward method
forward.exGK <- step(intercept_only.exGK, direction='forward', scope=formula(all.exGK), trace=0)

#view results of forward stepwise regression
forward.exGK$anova

#perform both stepwise regression
# start with the smallest model, factors are added one by one in the forward method
both1.exGK <- step(intercept_only.exGK, direction='both', scope=formula(all.exGK), trace=0)

#view results of forward stepwise regression
both1.exGK$anova

#perform backward stepwise regression
backward.exGK <- step(all.exGK, direction='backward', scope=formula(all.exGK), trace=0)

#view results of forward stepwise regression
backward.exGK$anova
```

Forward and both directions elimination are giving the same list of variables:  
  club_name, international_reputation, value_eur, age, overall, body_type, shooting.
Backward elimination gives the list of variables to eliminate from the model:
  league_name, nationality_name, club_position, preferred_foot, defending, pace, weight_kg, physic. 
Both methods agree and give the same significant variables to predict the wage.  

The list is the same as previously for each forward and backward directions minus the variables that we removed due to multicollinearity.

Using the variables selected with the forward method makes sense. 



  =====================  
# F - Questions of interest
  =====================  
##	Q1.	Using clustering, are players grouped based on their overall ratings, skill ratings, physical characteristics, and wages? What is the distribution across the clusters in terms of league, club, position, nationality, and reputation?"

### Including goalkeepers

#### k=2

Clustering:

```{r}
km.inGK.2 <- eclust(fifa.num.inGK.scaled, "kmeans", k=2, nstart = 25, graph = FALSE)
pam.inGK.2 <- eclust(fifa.num.inGK.scaled, "pam", k=2, nstart = 25, graph = FALSE)
hclust.inGK.2 <- eclust(fifa.num.inGK.scaled, "hclust", k=2, hc_metric = "euclidean", hc_method = "average", graph = FALSE)
```

*Cluster size*
```{r}
km.inGK.2$size
table(pam.inGK.2$clustering)
hclust.inGK.2$size
```

*Cluster means*
```{r}
aggregate(fifa.num.inGK, by = list(cluster=km.inGK.2$cluster), mean)
aggregate(fifa.num.inGK, by = list(cluster=pam.inGK.2$cluster), mean)
aggregate(fifa.num.inGK, by = list(cluster=hclust.inGK.2$cluster), mean)
```
Cluster 1
- significantly higher mean value_eur and wage_eur
- higher mean overall, potential
- similar age, height, weight


*Dendrogram*
```{r}
fviz_dend(hclust.inGK.2, show_labels = FALSE, palette = "RdBu", as.ggplot = TRUE)
```


#### k=3

Clustering:

```{r}
km.inGK.3 <- eclust(fifa.num.inGK.scaled, "kmeans", k=3, nstart = 25, graph = FALSE)
pam.inGK.3 <- eclust(fifa.num.inGK.scaled, "pam", k=3, nstart = 25, graph = FALSE)
hclust.inGK.3 <- eclust(fifa.num.inGK.scaled, "hclust", k=3, hc_metric = "euclidean", hc_method = "average", graph = FALSE)
```

*Cluster means*
```{r}
aggregate(fifa.num.inGK, by = list(cluster=km.inGK.3$cluster), mean)
aggregate(fifa.num.inGK, by = list(cluster=pam.inGK.3$cluster), mean)
aggregate(fifa.num.inGK, by = list(cluster=hclust.inGK.3$cluster), mean)
```

#### k=6

Clustering:

```{r}
km.inGK.6 <- eclust(fifa.num.inGK.scaled, "kmeans", k=6, nstart = 25, graph = FALSE)
pam.inGK.6 <- eclust(fifa.num.inGK.scaled, "pam", k=6, nstart = 25, graph = FALSE)
hclust.inGK.6 <- eclust(fifa.num.inGK.scaled, "hclust", k=6, hc_metric = "euclidean", hc_method = "average", graph = FALSE)
```

*Cluster means*
```{r}
aggregate(fifa.num.inGK, by = list(cluster=km.inGK.6$cluster), mean)
aggregate(fifa.num.inGK, by = list(cluster=pam.inGK.6$cluster), mean)
aggregate(fifa.num.inGK, by = list(cluster=hclust.inGK.6$cluster), mean)
```

#### Distribution based on Attack Position

```{r}
table(hclust.inGK.2$cluster, fifa.inGK$attack_position)
table(pam.inGK.3$cluster, fifa.inGK$attack_position)
```
k=2
Cluster 1
- composed mainly of Attack (33%) and Midfield positions (31%)

Cluster 2
- composed mainly of Defense (37%) and Midfield positions (37%)


#### Distribution based on League

Cluster 1
- mostly English Premier League (49%) and Spain Primera Division (31%)

Cluster 2
- almost evenly distributed from 4 leagues

```{r}
table(hclust.inGK.2$cluster, fifa.inGK$league_name)
table(pam.inGK.3$cluster, fifa.inGK$league_name)
```

#### Distribution based on Nationality

```{r}
table(hclust.inGK.2$cluster, fifa.inGK$nationality_name)
#table(pam.inGK.3$cluster, fifa.inGK$nationality_name)
```
*k=2*:
Cluster 1
- mostly from Brazil (6), France (6), Spain (6)

Cluster 2
- mostly from Spain (150), France (131), England (78), Italy (78), Brazil (39), Argentina (29)

*k=3*:
Cluster 1
- mostly from Spain (48), England (31), Brazil (26), France (26), Italy (22)

Cluster 2
- mostly from Spain (68), France (70), Italy (28), England (30)

Cluster 3
- mostly from Spain (40), France (41), Italy (31), England (20)

```{r}
cluster1 <- c("Brazil", "France", "Spain")
cluster1_counts <- c(6, 6, 6)

cluster2 <- c("Spain", "France", "England", "Italy", "Brazil", "Argentina")
cluster2_counts <- c(150, 131, 78, 78, 39, 29)

data <- data.frame(
  Country = c(cluster1, cluster2),
  Count = c(cluster1_counts, cluster2_counts),
  Cluster = c(rep("Cluster 1", length(cluster1)), rep("Cluster 2", length(cluster2)))
)

barplot(data$Count, names.arg = data$Country, col = c(rep("cornflowerblue", 3), rep("firebrick", 6)),
        main = "Nationality Distribution in Clusters", xlab = "Country",
        border = "black", ylim = c(0, max(data$Count) * 1.1))
legend("topright", legend = unique(data$Cluster), fill = c("cornflowerblue", "firebrick"))
```

```{r}
cluster1 <- c("Spain", "England", "Brazil", "France", "Italy")
cluster1_counts <- c(48, 31, 26, 26, 22)

cluster2 <- c("Spain", "France", "Italy", "England")
cluster2_counts <- c(68, 70, 28, 30)

cluster3 <- c("Spain", "France", "Italy", "England")
cluster3_counts <- c(40, 41, 31, 20)

data <- data.frame(
  Country = c(cluster1, cluster2, cluster3),
  Count = c(cluster1_counts, cluster2_counts, cluster3_counts),
  Cluster = c(rep("Cluster 1", length(cluster1)), rep("Cluster 2", length(cluster2)), rep("Cluster 3", length(cluster3)))
)

barplot(data$Count, names.arg = data$Country, col = c(rep("cornflowerblue", 5), rep("firebrick", 4), rep("aquamarine3", 4)),
        main = "Nationality Distribution in Clusters", xlab = "Country",
        border = "black", ylim = c(0, max(data$Count) * 1.1))
legend("topright", legend = unique(data$Cluster), fill = c("cornflowerblue", "firebrick", "aquamarine3"))
```

#### Distribution based on International reputation

Cluster 1
- mostly 3 and 4

Cluster 2
- mostly 1 and 2

```{r}
table(hclust.inGK.2$cluster, fifa.inGK$international_reputation)
table(pam.inGK.3$cluster, fifa.inGK$international_reputation)
```

### Excluding goalkeepers

#### k=2

Clustering:

```{r}
km.exGK.2 <- eclust(fifa.num.exGK.scaled, "kmeans", k=2, nstart = 25, graph = FALSE)
pam.exGK.2 <- eclust(fifa.num.exGK.scaled, "pam", k=2, nstart = 25, graph = FALSE)
hclust.exGK.2 <- eclust(fifa.num.exGK.scaled, "hclust", k=2, hc_metric = "manhattan", hc_method = "average", graph = FALSE)
```

*Cluster size*
```{r}
km.exGK.2$size
table(pam.exGK.2$clustering)
hclust.exGK.2$size
```

*Cluster means*
```{r}
aggregate(fifa.num.exGK, by = list(cluster=km.exGK.2$cluster), mean)
aggregate(fifa.num.exGK, by = list(cluster=pam.exGK.2$cluster), mean)
aggregate(fifa.num.exGK, by = list(cluster=hclust.exGK.2$cluster), mean)
```
Cluster 1
- significantly higher mean value_eur and wage_eur
- higher mean overall, potential
- similar age, height, weight
- higher pace, shooting, passing, dribbling


*Dendogram*
```{r}
fviz_dend(hclust.exGK.2, show_labels = FALSE, palette = "RdBu", as.ggplot = TRUE)
```

#### k=3

Clustering:

```{r}
km.exGK.3 <- eclust(fifa.num.exGK.scaled, "kmeans", k=3, nstart = 25, graph = FALSE)
pam.exGK.3 <- eclust(fifa.num.exGK.scaled, "pam", k=3, nstart = 25, graph = FALSE)
hclust.exGK.3 <- eclust(fifa.num.exGK.scaled, "hclust", k=3, hc_metric = "euclidean", hc_method = "average", graph = FALSE)
```

*Cluster means*
```{r}
aggregate(fifa.num.exGK, by = list(cluster=km.exGK.3$cluster), mean)
aggregate(fifa.num.exGK, by = list(cluster=pam.exGK.3$cluster), mean)
aggregate(fifa.num.exGK, by = list(cluster=hclust.exGK.3$cluster), mean)
```

*Cluster size*
```{r}
km.exGK.3$size
table(pam.exGK.3$clustering)
hclust.exGK.3$size
```

#### k=6

Clustering:

```{r}
km.inGK.6 <- eclust(fifa.num.inGK.scaled, "kmeans", k=6, nstart = 25, graph = FALSE)
pam.inGK.6 <- eclust(fifa.num.inGK.scaled, "pam", k=6, nstart = 25, graph = FALSE)
hclust.inGK.6 <- eclust(fifa.num.inGK.scaled, "hclust", k=6, hc_metric = "euclidean", hc_method = "average", graph = FALSE)
```

*Cluster means*
```{r}
aggregate(fifa.num.inGK, by = list(cluster=km.inGK.6$cluster), mean)
aggregate(fifa.num.inGK, by = list(cluster=pam.inGK.6$cluster), mean)
aggregate(fifa.num.inGK, by = list(cluster=hclust.inGK.6$cluster), mean)
```

#### Distribution based on Attack Position

```{r}
table(hclust.exGK.2$cluster, fifa.exGK$attack_position)
table(pam.exGK.3$cluster, fifa.exGK$attack_position)
```
k=2
Cluster 1
- composed mainly of Attack (33%) and Midfield positions (31%)

Cluster 2
- composed mainly of Defense (37%) and Midfield positions (37%)


#### Distribution based on League

Cluster 1
- mostly English Premier League (49%) and Spain Primera Division (31%)

Cluster 2
- almost evenly distributed from 4 leagues

```{r}
table(hclust.exGK.2$cluster, fifa.exGK$league_name)
table(pam.exGK.3$cluster, fifa.exGK$league_name)
```

#### Distribution based on Nationality

```{r}
table(hclust.inGK.2$cluster, fifa.inGK$nationality_name)
#table(pam.inGK.3$cluster, fifa.inGK$nationality_name)
```
*k=2*:
Cluster 1
- mostly from Brazil (6), France (6), Spain (6)

Cluster 2
- mostly from Spain (150), France (131), England (78), Italy (78), Brazil (39), Argentina (29)

*k=3*:
Cluster 1
- mostly from Spain (48), England (31), Brazil (26), France (26), Italy (22)

Cluster 2
- mostly from Spain (68), France (70), Italy (28), England (30)

Cluster 3
- mostly from Spain (40), France (41), Italy (31), England (20)

```{r}
cluster1 <- c("Brazil", "France", "Spain")
cluster1_counts <- c(6, 6, 6)

cluster2 <- c("Spain", "France", "England", "Italy", "Brazil", "Argentina")
cluster2_counts <- c(150, 131, 78, 78, 39, 29)

data <- data.frame(
  Country = c(cluster1, cluster2),
  Count = c(cluster1_counts, cluster2_counts),
  Cluster = c(rep("Cluster 1", length(cluster1)), rep("Cluster 2", length(cluster2)))
)

barplot(data$Count, names.arg = data$Country, col = c(rep("cornflowerblue", 3), rep("firebrick", 6)),
        main = "Nationality Distribution in Clusters", xlab = "Country",
        border = "black", ylim = c(0, max(data$Count) * 1.1))
legend("topright", legend = unique(data$Cluster), fill = c("cornflowerblue", "firebrick"))
```

```{r}
cluster1 <- c("Spain", "England", "Brazil", "France", "Italy")
cluster1_counts <- c(48, 31, 26, 26, 22)

cluster2 <- c("Spain", "France", "Italy", "England")
cluster2_counts <- c(68, 70, 28, 30)

cluster3 <- c("Spain", "France", "Italy", "England")
cluster3_counts <- c(40, 41, 31, 20)

data <- data.frame(
  Country = c(cluster1, cluster2, cluster3),
  Count = c(cluster1_counts, cluster2_counts, cluster3_counts),
  Cluster = c(rep("Cluster 1", length(cluster1)), rep("Cluster 2", length(cluster2)), rep("Cluster 3", length(cluster3)))
)

barplot(data$Count, names.arg = data$Country, col = c(rep("cornflowerblue", 5), rep("firebrick", 4), rep("aquamarine3", 4)),
        main = "Nationality Distribution in Clusters", xlab = "Country",
        border = "black", ylim = c(0, max(data$Count) * 1.1))
legend("topright", legend = unique(data$Cluster), fill = c("cornflowerblue", "firebrick", "aquamarine3"))
```

#### Distribution based on International reputation

Cluster 1
- mostly 3 and 4

Cluster 2
- mostly 1 and 2

```{r}
table(hclust.exGK.2$cluster, fifa.exGK$international_reputation)
table(pam.exGK.3$cluster, fifa.exGK$international_reputation)
```


###Distribution across clusters

#### i. Using K-means

**Using goalkeepers data**
```{r}
km.res.inGK.wss$centers
```

**Without goalkeepers data**
```{r}
km.res.exGK.wss$centers
```

-If we use goalkeepers data we can see that overall, potential, value_eur & wage_eur are clubbed together while demographics like age, height_cm & weight_kg remain in other clusters. 

-if we do not consider goalkeepers data and remove all the blank rows we observe that along with performance/pay attributes and demographics, the physical attributes like pace, shooting, passing, dribbling, defending and phsyic are inclined towards each other indicating that k=3 is the right value for clusters.

-Overall, the clusters shows that distribution remains in terms of physical attributes, overall/pay & demographics.

##	Q2. Can we identify the team with the best worth in each league for an affordable investment?

```{r}
best_team = fifa %>% group_by(league_name, club_name) %>%
                   summarise(Overall_per_team = sum(value_eur), 
                             Total_Wage = sum(wage_eur), 
                             Overall_worth = Overall_per_team/Total_Wage,
                             .groups = 'drop')
#best_team
final_team = best_team%>%group_by(league_name) %>%
                   slice(which.max(Overall_worth))# %>%
  #select(c(club_name,league_name))
                             
                  
final_team[,c(1,2,5)]


```

#### 1. Calculate Overall Worth using value/wage ratio:
   - **Overall_per_team**: Sum of the value (in euros) of all players in each team.
   - **Total_Wage**: Sum of the total wage (in euros) of all players in each team.
   - **Overall_worth(Value/Wage)**: This metric represents the ratio of the total value of players in a team to the total wage expenditure. It provides a measure of how much value a team gets per unit of wage spent. Teams with a higher value/wage ratio are generally considered to be more efficient in terms of player investment.
   
    
   
```{r}
ggplot(final_team, aes(x = league_name, y = Overall_worth, fill = club_name)) +
  geom_bar(stat = "identity") +
  labs(title = "Teams with Best Worth in Each League",
       x = "League Name",
       y = "Overall Worth (value/wage ratio)",
       fill = "Club Name") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
   
Based on the analysis, the following clubs have been identified as offering the best worth in each league for an affordable investment:

- **English Premier League**: Liverpool - Overall worth: 393.29
- **French Ligue 1**: LOSC Lille - Overall worth: 587.27
- **Italian Serie A**: AC Milan - Overall worth: 730.35
- **Spain Primera Division**: Sevilla FC - Overall worth: 819.25

These clubs stand out as the most valuable investments within their respective leagues, considering both player value and wage expenditure.

#### 2. Calculate Overall Worth using Overall(ratings)/Wage Ratio ratio:

```{r}
best_team = fifa %>% group_by(league_name, club_name) %>%
                   summarise(Overall_per_team = sum(overall), 
                             Total_Wage = sum(wage_eur), 
                             Overall_worth = Overall_per_team/Total_Wage,
                             .groups = 'drop')
#best_team
final_team = best_team%>%group_by(league_name) %>%
                   slice(which.max(Overall_worth))# %>%
  #select(c(club_name,league_name))
                             
                  
final_team[,c(1,2,5)]


```

-**Calculating the metric Overall Worth(Overall/Wage Ratio)**: This metric represents the ratio of the overall ratings of players in a team to the total wage expenditure. This ratio represents the value a club gets in terms of player skills for every unit of currency spent on wages.. Teams with a higher overall/wage ratio are considered to have a higher quality of players relative to their wage expenditure.


```{r}
ggplot(final_team, aes(x = league_name, y = Overall_worth, fill = club_name)) +
  geom_bar(stat = "identity") +
  labs(title = "Teams with Best Worth in Each League",
       x = "League Name",
       y = "Overall Worth (Overall rating/wage ratio)",
       fill = "Club Name") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
The analysis identifies the club with the highest overall worth, calculated as the ratio of overall player ratings to total wage expenditure, in each league:

- **English Premier League**: Norwich City (Overall Worth: 0.0024)
- **French Ligue 1**: FC Lorient (Overall Worth: 0.0059)
- **Italian Serie A**: Spezia (Overall Worth: 0.0073)
- **Spain Primera Division**: Rayo Vallecano (Overall Worth: 0.0043)




##	Q3. Predict the wage of a player in each league based on their abilities, physical characteristics, and nationality.
### Use stepwise forward
We will use the stepwise model generated for players including goal keepers.  
We will then measure the accuracy of the prediction on a small test sample (10%).  
**Split data into train and test for stepwise**
```{r}
fifa.step <- fifa.inGK
#colnames(fifa.step)
# remove the name of the player, and international_reputation_factor, attack_position which is not an original column 
fifa.step <- fifa.inGK[, !names(fifa.inGK) %in% c('international_reputation_factor','attack_position')]
# convert international_reputation into a factor
fifa.step$international_reputation <- as.factor(fifa.step$international_reputation)
#dim(fifa.step)
#head(fifa.step)
#colnames(fifa.step)

#splitting data into train and test 80% - 20%
set.seed(789) 
indices <- sample(1:nrow(fifa.step), size = nrow(fifa.step) * 0.9)
train_fifa <- fifa.step[indices, ]
test_fifa <- fifa.step[-indices, ]
# add the attack_position colun in the test subset
test_fifa$attack_position <- fifa.inGK[-indices, ]$attack_position

#head(train_fifa)
#head(test_fifa)
dim(train_fifa)
dim(test_fifa)
#define intercept-only model
intercept_only <- lm(wage_eur ~ 1, data=train_fifa)

#perform forward stepwise regression
# start with the smallest model, factors are added one by one in the forward method
forward.inGK <- step(intercept_only, direction='forward', scope=formula(all), trace=0)

#summary(forward.inGK)

```

### predict and results
**Apply the model on the test 5%**
```{r}
#predict wage on the test dataset
test_fifa$calc_wage <- predict(forward.inGK, newdata=test_fifa)
# calculate the % of error
test_fifa$pct_error <- ((test_fifa$calc_wage - test_fifa$wage_eur)/test_fifa$wage_eur) * 100
head(test_fifa[c("league_name","club_name","international_reputation","club_position","overall","wage_eur","calc_wage","pct_error")])
test_fifa_numerical <- test_fifa %>% select_if(is.numeric)

#stats on the wage, calc_wage and pct_error
describe(test_fifa_numerical)

#head(test_fifa,20)
View(test_fifa)

#distribution of the test dataset
table(test_fifa$international_reputation,test_fifa$league_name)
table(test_fifa$attack_position,test_fifa$league_name)

#plot the prediction vs the reality
plot(test_fifa$wage_eur,test_fifa$calc_wage)
```

Using the stepwise elimination and applying the model on the 5% test dataset, we manage to predict the wage of the test sample. The value calculated is compared to the actual wage of the player. We also calculated the average error.  
Plotting the predicted wage vs the atual wage we can see that the result is generally correct in the middle of the curve. The outliers i.e. wage above 100,000 or very low are generating a larger percentage of error.  

##	Q4. Can we determine the international player’s reputation from their contribution to their club?

### Use k-means, k-medoids, hierarchical for 5 clusters

We will use clustering technique to see if 5 categories of players can be determined and if it correspond to their international reputation.  We want to include Goal Keepers, so we will ignore the individual skills ratings (fifa.num.inGK.scaled)

**Use kmeans, kmedoids, hierarchical clusters with few linkage methods for 5 clusters (eclust)**
*Including Goal Keepers*
```{r}

# K-means clustering
km.res5 <- eclust(fifa.num.inGK.scaled, "kmeans", k = 5, nstart = 25, graph = FALSE)
# Visualize k-means clusters
fviz_cluster(km.res5, geom = "point", ellipse.type = "convex",
             palette = "jco", ggtheme = theme_minimal())

# K-medoids clustering
kmd.res5 <- eclust(fifa.num.inGK.scaled, "pam", k = 5, nstart = 25, graph = FALSE)
# Visualize k-medoids clusters
fviz_cluster(kmd.res5, geom = "point", ellipse.type = "convex",
             palette = "jco", ggtheme = theme_minimal())

# Hierarchical clustering
hc.res5 <- eclust(fifa.num.inGK.scaled, "hclust", k = 5, hc_metric = "euclidean", 
                 hc_method = "ward.D2", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res5, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)

# Hierarchical clustering
hc.res5c <- eclust(fifa.num.inGK.scaled, "hclust", k = 5, hc_metric = "euclidean", 
                 hc_method = "complete", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res5c, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)

# Hierarchical clustering
hc.res5a <- eclust(fifa.num.inGK.scaled, "hclust", k = 5, hc_metric = "euclidean", 
                 hc_method = "average", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res5a, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)

```
average linkage for hierarchical clustering doesn't give a good result.  


### external clustering validation
```{r}
# table to compare the truth with the cluster affectation, how many TP and TN
table(fifa.inGK$international_reputation, km.res5$cluster) 
table(fifa.inGK$international_reputation, kmd.res5$cluster)
table(fifa.inGK$international_reputation, hc.res5$cluster)
table(fifa.inGK$international_reputation, hc.res5c$cluster)
table(fifa.inGK$international_reputation, hc.res5a$cluster)
```

From the distribution, nothing look like a clear separation of the international reputation.  
The hierarchical clustering with complete linkage is the one that gives the closest result to what we are looking for.  


Rand index, corrected Rand index, Meila's VI  
```{r}
# Compute cluster stats
int_rep <- as.numeric(as.factor(fifa.inGK$international_reputation)) #Convert international_reputation  into a number for the statistic calculation
clust_stats.km5  <- cluster.stats(d = dist(fifa.num.inGK.scaled), # distance matrix
                             int_rep, km.res5$cluster) #label changed to numeric , #cluster assigned
clust_stats.kmd5 <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep, kmd.res5$cluster) 
clust_stats.hc5  <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep, hc.res5$cluster) 
clust_stats.hc5c <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep, hc.res5c$cluster) 
clust_stats.hc5a <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep, hc.res5a$cluster)

```

Rand index and Meila's VI index 
```{r}
# Corrected Rand index and Meila VI index
print(cat("kmeans                5 clusters, Corr Rand index = ",clust_stats.km5$corrected.rand," Miela VI = ", clust_stats.km5$vi))
print(cat("kmedoids              5 clusters, Corr Rand index = ",clust_stats.kmd5$corrected.rand," Miela VI = ", clust_stats.kmd5$vi))
print(cat("hierarchical(Ward.D2) 5 clusters, Corr Rand index = ",clust_stats.hc5$corrected.rand," Miela VI = ", clust_stats.hc5$vi))
print(cat("hierarchical(compl)   5 clusters, Corr Rand index = ",clust_stats.hc5c$corrected.rand," Miela VI = ", clust_stats.hc5c$vi))
print(cat("hierarchical(average) 5 clusters, Corr Rand index = ",clust_stats.hc5a$corrected.rand," Miela VI = ", clust_stats.hc5a$vi))
```
Corrected Rand index are small below or 0.1, Miela VI is around 2.2 and 2.3 . All 3 clustering methods give similar values for those indexes. Those values are not showing a successful clustering method.
Miela VI for average linkage in hierarchical clustering is below other methods so the result might be not as good. This is already seen in the dendrogram.


### Use k-means, k-medoids, hierarchical for 3 clusters

**Use kmeans, kmedoids, hierarchical clusters with few linkage methods for 3 clusters (eclust)**  
*Including Goal Keepers*  

We will use clustering technique to see if 3 categories of players can be determined and if it corresponds to their simplified international reputation.  We want to include Goal Keepers, so we will ignore the individual skills ratings (fifa.num.inGK.scaled)  

```{r}

# K-means clustering
km.res3 <- eclust(fifa.num.inGK.scaled, "kmeans", k = 3, nstart = 25, graph = FALSE)
# Visualize k-means clusters
fviz_cluster(km.res3, geom = "point", ellipse.type = "convex",
             palette = "jco", ggtheme = theme_minimal())

# K-medoids clustering
kmd.res3 <- eclust(fifa.num.inGK.scaled, "pam", k = 3, nstart = 25, graph = FALSE)
# Visualize k-medoids clusters
fviz_cluster(kmd.res3, geom = "point", ellipse.type = "convex",
             palette = "jco", ggtheme = theme_minimal())

# Hierarchical clustering
hc.res3 <- eclust(fifa.num.inGK.scaled, "hclust", k = 3, hc_metric = "euclidean", 
                 hc_method = "ward.D2", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res3, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)

# Hierarchical clustering
hc.res3c <- eclust(fifa.num.inGK.scaled, "hclust", k = 3, hc_metric = "euclidean", 
                 hc_method = "complete", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res3c, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)

# Hierarchical clustering
hc.res3a <- eclust(fifa.num.inGK.scaled, "hclust", k = 3, hc_metric = "euclidean", 
                 hc_method = "average", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res3a, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)
```
### external clustering validation
```{r}
# table to compare the truth with the cluster affectation, how many TP and TN
table(fifa$international_reputation_factor, km.res3$cluster) 
table(fifa$international_reputation_factor, kmd.res3$cluster)
table(fifa$international_reputation_factor, hc.res3$cluster)
table(fifa$international_reputation_factor, hc.res3c$cluster)
table(fifa$international_reputation_factor, hc.res3a$cluster)
```
From the distribution, nothing look like a clear separation of the simplified international reputation.  
The hierarchical clustering with complete linkage is the one that gives the closest result to what we are looking for.  


Rand index, corrected Rand index, Meila's VI  
```{r}
# Compute cluster stats
int_rep_factor <- as.numeric(as.factor(fifa$international_reputation_factor)) #Convert international_reputation  into a number for the statistic calculation
clust_stats.km3  <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep_factor, km.res3$cluster) 
clust_stats.kmd3 <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep_factor, kmd.res3$cluster)
clust_stats.hc3  <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep_factor, hc.res3$cluster) 
clust_stats.hc3c <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep_factor, hc.res3c$cluster) 
clust_stats.hc3a <- cluster.stats(d = dist(fifa.num.inGK.scaled), int_rep_factor, hc.res3a$cluster) 
```

Rand index and Meila's VI index 
```{r}
# Corrected Rand index and Meila VI index
print(cat("kmeans                3 clusters, Corr Rand index = ",clust_stats.km3$corrected.rand," Miela VI = ", clust_stats.km3$vi))
print(cat("kmedoids              3 clusters, Corr Rand index = ",clust_stats.kmd3$corrected.rand," Miela VI = ", clust_stats.kmd3$vi))
print(cat("hierarchical(Ward.D2) 3 clusters, Corr Rand index = ",clust_stats.hc3$corrected.rand," Miela VI = ", clust_stats.hc3$vi))
print(cat("hierarchical(compl)   3 clusters, Corr Rand index = ",clust_stats.hc3c$corrected.rand," Miela VI = ", clust_stats.hc3c$vi))
print(cat("hierarchical(average) 3 clusters, Corr Rand index = ",clust_stats.hc3a$corrected.rand," Miela VI = ", clust_stats.hc3a$vi))
```
Corrected Rand index are small below or 0.1, Miela VI is around 1.6 . All 3 clustering methods give similar values for those indexes. Those values are worse than for the 5 clusters.
Miela VI for average linkage in hierarchical clustering is below other methods so the result might be not as good. This is already seen in the dendrogram.


### Use k-means, k-medoids, hierarchical for 3 clusters  

**Use kmeans, kmedoids, hierarchical clusters with few linkage methods for 3 clusters (eclust)**
*Excluding Goal Keepers*

We will use clustering technique to see if 3 categories of players can be determined and if it corresponds to their simplified international reputation.  We exclude Goal Keepers to be able to use the individual skills ratings (fifa.num.exGK.scaled)  

```{r, warning=FALSE, message=FALSE}

# K-means clustering
km.res3 <- eclust(fifa.num.exGK.scaled, "kmeans", k = 3, nstart = 25, graph = FALSE)
# Visualize k-means clusters
fviz_cluster(km.res3, geom = "point", ellipse.type = "convex",
             palette = "jco", ggtheme = theme_minimal())

# K-medoids clustering
kmd.res3 <- eclust(fifa.num.exGK.scaled, "pam", k = 3, nstart = 25, graph = FALSE)
# Visualize k-medoids clusters
fviz_cluster(kmd.res3, geom = "point", ellipse.type = "convex",
             palette = "jco", ggtheme = theme_minimal())

# Hierarchical clustering linkage ward.D2
hc.res3 <- eclust(fifa.num.exGK.scaled, "hclust", k = 3, hc_metric = "euclidean", 
                 hc_method = "ward.D2", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res3, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)

# Hierarchical clustering linkage complete
hc.res3c <- eclust(fifa.num.exGK.scaled, "hclust", k = 3, hc_metric = "euclidean", 
                 hc_method = "complete", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res3c, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)

# Hierarchical clustering linkage average
hc.res3a <- eclust(fifa.num.exGK.scaled, "hclust", k = 3, hc_metric = "euclidean", 
                 hc_method = "average", graph = FALSE)
# Visualize dendrograms
fviz_dend(hc.res3a, show_labels = FALSE,
         palette = "jco", as.ggplot = TRUE)

```
### external clustering validation
```{r}
# table to compare the truth with the cluster assignment, how many TP and TN
table(fifa.exGK$international_reputation_factor, km.res3$cluster) 
table(fifa.exGK$international_reputation_factor, kmd.res3$cluster)
table(fifa.exGK$international_reputation_factor, hc.res3$cluster)
table(fifa.exGK$international_reputation_factor, hc.res3c$cluster)
table(fifa.exGK$international_reputation_factor, hc.res3a$cluster)
```
From the distribution, nothing look like a clear separation of the simplified international reputation.  

Are the 3 clusters correspond to the attack_position?  
```{r}
# table to compare the truth with the cluster assignment, how many TP and TN
table(fifa.exGK$attack_position, km.res3$cluster) 
table(fifa.exGK$attack_position, kmd.res3$cluster)
table(fifa.exGK$attack_position, hc.res3$cluster)
table(fifa.exGK$attack_position, hc.res3c$cluster)
table(fifa.exGK$attack_position, hc.res3a$cluster)
```
From the distribution, nothing look like a clear separation of the simplified position.  

Rand index, corrected Rand index, Meila's VI  
```{r}
# Compute cluster stats
int_rep_factor <- as.numeric(as.factor(fifa.exGK$international_reputation_factor)) #Convert international_reputation  into a number for the statistic calculation
clust_stats.km3  <- cluster.stats(d = dist(fifa.num.exGK.scaled), int_rep_factor, km.res3$cluster) 
clust_stats.kmd3 <- cluster.stats(d = dist(fifa.num.exGK.scaled), int_rep_factor, kmd.res3$cluster)
clust_stats.hc3  <- cluster.stats(d = dist(fifa.num.exGK.scaled), int_rep_factor, hc.res3$cluster) 
clust_stats.hc3c <- cluster.stats(d = dist(fifa.num.exGK.scaled), int_rep_factor, hc.res3c$cluster) 
clust_stats.hc3a <- cluster.stats(d = dist(fifa.num.exGK.scaled), int_rep_factor, hc.res3a$cluster) 
```

Rand index and Meila's VI index 
```{r}
# Corrected Rand index and Meila VI index
print(cat("kmeans                3 clusters, Corr Rand index = ",clust_stats.km3$corrected.rand," Miela VI = ", clust_stats.km3$vi))
print(cat("kmedoids              3 clusters, Corr Rand index = ",clust_stats.kmd3$corrected.rand," Miela VI = ", clust_stats.kmd3$vi))
print(cat("hierarchical(Ward.D2) 3 clusters, Corr Rand index = ",clust_stats.hc3$corrected.rand," Miela VI = ", clust_stats.hc3$vi))
print(cat("hierarchical(compl)   3 clusters, Corr Rand index = ",clust_stats.hc3c$corrected.rand," Miela VI = ", clust_stats.hc3c$vi))
print(cat("hierarchical(average) 3 clusters, Corr Rand index = ",clust_stats.hc3a$corrected.rand," Miela VI = ", clust_stats.hc3a$vi))
```

Corrected Rand index are small below or 0.1, Miela VI is around 1.6 . All 3 clustering methods give similar values for those indexes.   Those values are not showing a successful clustering method.  
Miela VI for average linkage in hierarchical clustering is below other methods so the result might be not as good. This is already seen in the dendrogram.


### Try DBSCAN method
**Try DBScan on dataset including Goal Keepers**
```{r}
#DBSCAN
#set.seed(123)
db.inGK <- dbscan(fifa.num.inGK.scaled, eps = 0.25, MinPts = 5)
# Plot DBSCAN results
fviz_cluster(db.inGK, data = fifa.num.inGK.scaled, stand = FALSE,
             ellipse = FALSE, show.clust.cent = FALSE,
             geom = "point",palette = "jco", ggtheme = theme_classic())
```
No cluster identified with a small distance (eps=0.25)   


```{r}
#DBSCAN
#set.seed(123)
db.inGK <- dbscan(fifa.num.inGK.scaled, eps = 1, MinPts = 5)
# Plot DBSCAN results
fviz_cluster(db.inGK, data = fifa.num.inGK.scaled, stand = FALSE,
             ellipse = FALSE, show.clust.cent = FALSE,
             geom = "point",palette = "jco", ggtheme = theme_classic())
```
Using a large distance (eps=1) generates 2 clusters and a lot of noise, but it doesn't seem accurate as almost every point is in cluster 1.

**Try DBScan on dataset excluding Goal Keepers**
```{r}
#DBSCAN
#set.seed(123)
db.exGK <- dbscan(fifa.num.exGK.scaled, eps = 0.25, MinPts = 5)
# Plot DBSCAN results
fviz_cluster(db.exGK, data = fifa.num.exGK.scaled, stand = FALSE,
             ellipse = FALSE, show.clust.cent = FALSE,
             geom = "point",palette = "jco", ggtheme = theme_classic())
```
No cluster identified with a small distance (eps=0.25)   
  
```{r}
#DBSCAN
#set.seed(123)
db.exGK <- dbscan(fifa.num.exGK.scaled, eps = 1, MinPts = 10)
# Plot DBSCAN results
fviz_cluster(db.exGK, data = fifa.num.exGK.scaled, stand = FALSE,
             ellipse = FALSE, show.clust.cent = FALSE,
             geom = "point",palette = "jco", ggtheme = theme_classic())
```  

No cluster identified even with a large distance (eps=1) 

In conclusion , clustering didn't allow to identify the international_reputation, simplified international_reputation, or even attack_position. The validation statistics were low and the distribution was not convincing.


  =====================  
# G - Conclusion	
  =====================  
##	Techniques we used to answer the 4 questions
##	Summary of the answers
##	What we can have done better

###Key Insights:-
### Conclusion and Reflection on FIFA Player Analysis

**Key Insights:** 

1. Stepwise Regression Analysis: revealed that a player's international reputation is significantly influenced by their overall rating, wage, league participation, age, and potential. Inclusion of goalkeepers in the analysis highlighted the unique skills associated with this position.??

2. Clustering Analysis: organized players into clusters based on a combination of attributes, which included performance, compensation, physical attributes, and demographic details. The distinct grouping dynamics of *goalkeepers* underscored their unique role in the sport.

3. Wage Prediction Efforts: underscored the complexity of wage structures. Our predictive model indicated that a deeper look into the intricacies of contract negotiations and external influences is necessary for accurate wage forecasting.

5. International Reputation Clustering: was less definitive, suggesting that a player's reputation is multifaceted and perhaps not easily quantifiable through conventional statistical data. 

**Reflection**

- While statistical techniques provided valuable insights, they also revealed the limitations of quantitative analysis in capturing the full spectrum of a player's *marketability and reputation*. Future models could benefit from integrating qualitative data such as brand endorsements and fan popularity.??

- The emergence of multicollinearity in our models signals the need for more refined statistical methods, perhaps involving regularization techniques to address overfitting and enhance predictive power.